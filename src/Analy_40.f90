!! analy_40.f90 is a part of the PACIAE event generator.
!! Copyright (C) 2024 PACIAE Group.
!! PACIAE is licensed under the GNU GPL v2 or later, see LICENSE for details.
!! Open source: https://github.com/ArcsaberHep/PACIAE4
!! Author: Ben-Hao Sa, December 2019 - November 2024.

!> This is an internal analyzing program to count some distributions for the
!!   particles generated by PACIAE.

!                                              By Ben-Hao at CIAE on 28/12/2019
!!                                  Last updated by An-Ke at UiO  on 17/01/2025


        subroutine analy(nmin,nminf,ncha,nchaf,wgt,sum_wgt)
!!      Analyses an event based on the messages in "PYJETS".
!       It was composed by Ben-Hao Sa on 28/12/2019.
        IMPLICIT DOUBLE PRECISION(A-H, O-Z)
        IMPLICIT INTEGER(I-N)
        LOGICAL IS_EXIST
        PARAMETER (KSZJ=80000)
        COMMON/PYJETS/N,NPAD,K(KSZJ,5),P(KSZJ,5),V(KSZJ,5)
        common/sa1/kjp21,non1,bp,iii,neve,nout,nosc
        common/sa7/ispmax,isdmax,iflmax,ispkf(100),n_bin_hist,asd(10), &
         afl(100,10,2),i_y_or_eta
        common/sa10/csnn,cspin,cskn,cspipi,cspsn,cspsm,rcsit,ifram, &
         iabsb,iabsm,i_sigma_AQM,ajpsi,csspn,csspm,csen
        common/sa12/ppsa(5),nchan,nsjp,sjp,ttaup,taujp
        common/sa21/pincl(5),pscal(5),pinch(5),vnu,fq2,w2l,yyl,zl,xb, &
         pph,vnlep
        common/sa24/adj1(40),nnstop,non24,zstop
        common/sa30/vneump,vneumt,mstptj
        common/syspar/ipden,itden,suppm,suptm,suppc,suptc,r0p,r0t, &
         nap,nat,nzp,nzt,pio
        common/anly1/an(100,10,100),bn(100,2),anf(100,10,100),bnf(100,2)
        common/anly4/ distr(100,10,5), dMult(5,2), distr_f(100,10,5), &
         dMult_f(5,2), san_distr(100,10,5), sbn_mult(5,2), &
         san_distr_f(100,10,5), sbn_mult_f(5,2), sao_distr(100,10,5), &
         sbo_mult(5,2), sao_distr_f(100,10,5), sbo_mult_f(5,2)
        COMMON/SA1_PY8/ i_mode, i_tune, KF_woDecay(100), &
               KF_proj, KF_targ, win, energy_B, psno, b_min, b_max
        common/ flow_h / snum_h_integral(100,2),   &
                         flow_h_integral(100,4,2), &
                         dNy_h_f(100,100),      &
                         dNy_h(100,100),        &
                         dNpT_h_f(100,100),     &
                         dNpT_h(100,100),       &
                         dNeta_h_f(100,100),    &
                         dNeta_h(100,100),      &
                         dvdy_h_f(100,4,100),   &
                         dvdy_h(100,4,100),     &
                         dvdpT_h_f(100,4,100),  &
                         dvdpT_h(100,4,100),    &
                         dvdeta_h_f(100,4,100), &
                         dvdeta_h(100,4,100)
        common/ flow_part / snum_particle_integral(5,2),   &
                            flow_particle_integral(5,4,2), &
                            dNy_particle_f(100,5),      &
                            dNy_particle(100,5),        &
                            dNpT_particle_f(100,5),     &
                            dNpT_particle(100,5),       &
                            dNeta_particle_f(100,5),    &
                            dNeta_particle(100,5),      &
                            dvdy_particle_f(100,4,5),   &
                            dvdy_particle(100,4,5),     &
                            dvdpT_particle_f(100,4,5),  &
                            dvdpT_particle(100,4,5),    &
                            dvdeta_particle_f(100,4,5), &
                            dvdeta_particle(100,4,5)
        real*8 nmin,nminf,ncha,nchaf
        dimension c(10)

!       wgt (sum_wgt): weight (total weight) of the current (total) event.
!          normally = 1 (Neve), but non-one (non-Neve) for the biased event.

!       ispmax: maximum # of particle KF code wanted to statistics
!       ispkf: array of particle KF code
!       ispkf(i): KF code of i-th particle
!       kfmax: dimention of ispkf array, i.e. maximum # of KF code considered
!       bn(i) (bnf(i)): multiplicity of i-th particle in partial (full)
!        phase space
!       an(l,i,j) (anf(l,i,j)): three dimension array in partial (full)
!         phase space
!       l: order # of y (pt, eta, ...) interval
!       i: kind of distribution
!       for pp, NA,AN and AB collisions
!        i=1: for y
!        i=2: for pt (inv. pT)
!        i=3: for eta
!        i=4: for mT
!        i=5: for event-wise multiplicity
!        i=6: for pT (dN/dpT)
!       for lp and lA collisions
!        i=1 : z
!        i=2 : \nu
!        i=3 : Q^2
!         .        .
!         .        .
!         .        .
!       j: order # of particle in array of 'ispkf' (1 to ispmax)
!       isdmax: maximum # of distributions considered
!       asd(i): interval segmented for i-th distribution
!       iflmax: maximum # of windows, =0 means no window at all
!       afl(j,i,1): lower bound of i-th window for j-th particle
!       afl(j,i,2): upper bound of i-th window for j-th particle
!       for pp,NA,AN and AB collisions
!        i=1: y/eta window (depends on i_y_or_eta)
!        i=2: pt window
!         .        .
!         .        .
!         .        .
!       for lp and lA collisions
!        i=1 : Q^2=-q^2 (fq2 named in program) window
!        i=2 : W^2 (w2l) window
!        i=3 : y (yyl) window
!        i=4 : P_h (pph) window
!        i=5 : z (zl) window
!         .        .
!         .        .
!         .        .

!       for lp and lA collisions
!       pincl (pscal): four momentum and mass of incident (scatterd) lepon
!       pinch: four momentum and mass of incident hadron
!       vnu: \nu; fq2: Q^2=-q^2; w2l: W^2; yyl: y; zl: z; xb: x_B; pph: P_h

!       i_y_or_eta: select y or eta in partial phase-space statistics.
!                   = 0 , y
!                   = 1 , eta

!       largest momentum allowed for particle
        dpmax  = adj1(27)
        iadj140 = INT( adj1(40) )

!       initializes the variales
        nmin  = 0D0
        nminf = 0D0
        ncha  = 0D0
        nchaf = 0D0
        bn    = 0D0
        bnf   = 0D0
        an    = 0D0
        anf   = 0D0
        dMult   = 0D0
        dMult_f = 0D0
        distr   = 0D0
        distr_f = 0D0
        if( iii == 1 )then
            ! For flows of hadrons.
            snum_h_integral = 0D0
            flow_h_integral = 0D0
            dNy_h_f    = 0D0
            dNy_h      = 0D0
            dNpT_h_f   = 0D0
            dNpT_h     = 0D0
            dNeta_h_f  = 0D0
            dNeta_h    = 0D0
            dvdy_h_f   = 0D0
            dvdy_h     = 0D0
            dvdpT_h_f  = 0D0
            dvdpT_h    = 0D0
            dvdeta_h_f = 0D0
            dvdeta_h   = 0D0
            ! For flows of total, charged and pi+K+p particles.
            snum_particle_integral = 0D0
            flow_particle_integral = 0D0
            dNy_particle_f    = 0D0
            dNy_particle      = 0D0
            dNpT_particle_f   = 0D0
            dNpT_particle     = 0D0
            dNeta_particle_f  = 0D0
            dNeta_particle    = 0D0
            dvdy_particle_f   = 0D0
            dvdy_particle     = 0D0
            dvdpT_particle_f  = 0D0
            dvdpT_particle    = 0D0
            dvdeta_particle_f = 0D0
            dvdeta_particle   = 0D0
        end if

!       analyses an event
        do j=1,N,1
!       Exclude historical entries.
            KS = K(j,1)
            if( .NOT.IS_EXIST(KS,i_mode) ) cycle
            ik   = k(j,2)
            plu6 = PAPYP(j,6)
            eta  = PAPYP(j,19)
            w    = 1D0
            ! w  = wgt
            wgt  = wgt
            swgt = sum_wgt
            p1   = p(j,1)
            p2   = p(j,2)
            p3   = p(j,3)
            p4   = p(j,4)
            p5   = p(j,5)
            yy   = PAPYP(j,17)
            ppt  = PAPYP(j,10)
            ppm = dsqrt( p1*p1 + p2*p2 + p3*p3 )
            if( ppm > dpmax .or. p4 > dpmax ) cycle
!       for pp,pA (Ap) & AB
            if(ipden < 11)then
                c(1) = yy
                if( i_y_or_eta == 1 ) c(1) = eta
                c(2) = ppt
!               .
!               .
!               .
                kkk = 1
!       statistics of negative multiplicity
                ! for hadron
                if( iadj140 >= 3 .and. plu6 < -0.9 )then
                    nminf = nminf + w
                    do i=1,iflmax
                        if(c(i) < afl(kkk,i,1).or.c(i) > afl(kkk,i,2)) goto 700
                    enddo
                    nmin = nmin + w
700             endif
                ! for parton
                if( iadj140 < 3 .and. plu6 < -0.2 )then
                    nminf = nminf + w
                    do i=1,iflmax
                        if(c(i) < afl(kkk,i,1).or.c(i) > afl(kkk,i,2)) goto 702
                    enddo
                    nmin = nmin + w
702             endif
!       statistics of positive multiplicity
            ! for hadron
                if( iadj140 >= 3 .and. plu6 > 0.9 )then
                    nchaf = nchaf + w
                    do i=1,iflmax
                        if(c(i) < afl(kkk,i,1).or.c(i) > afl(kkk,i,2)) goto 701
                    enddo
                    ncha = ncha + w
701             endif
                ! for parton
                if( iadj140 < 3 .and. plu6 > 0.2 )then
                    nchaf = nchaf + w
                    do i=1,iflmax
                        if(c(i) < afl(kkk,i,1).or.c(i) > afl(kkk,i,2)) goto 703
                    enddo
                    ncha = ncha + w
703             endif
            endif

!       statistics of y, pt, ... distributions (for NA,AN,and BA); z, \nu,
!        ... distributions (for lp and -lA)

!????????????????????????????????????????????????????????????????????
!       excludes the projectile and the target spectator nucleons
            if( ik == 2212 .or. ik == 2112 )then
                if( ppt <= 1D-5 ) cycle
            endif
!????????????????????????????????????????????????????????????????????

!           For total, charged and pi+K+p.
            call stati_particle(yy,ppt,eta,p5,plu6,ik,w)
            call flow_particle( p1, p2, yy, ppt, eta, plu6, ik, w )

            do kk=1,ispmax,1
                kf = ispkf(kk)
                if( ik /= kf ) cycle
                ! analyses for pp, pA and AB
                if( ipden < 11 )then
                    call stati_h(yy,ppt,eta,p5,ik,kk,w,an,anf,bn,bnf)
                    call flow_hadron( p1, p2, yy, ppt, eta, kk, w )
                end if
                ! analyses for lp and lA
                if( ipden >= 11 .and. ipden <= 16 ) &
                call stati_l(p1,p2,p3,p4,p5,ik,kk,w,an,anf,bn,bnf)
                exit
            end do
        end do

!       statistics of multiplicity distributions,
!        spectator nucleons are excluded
        do kkk=1,ispmax,1
!       multiplicity is located at which interval
            idf = INT( bnf(kkk,1) / w / asd(5) + 1 )
!       the 5-th distribution is particle multiplicity distribution
            if(idf < 1 .or. idf > n_bin_hist .OR. bnf(kkk,1) < 1D-10) goto 405
            anf(idf,5,kkk) = anf(idf,5,kkk) + w/asd(5)
!       activate the window
405         continue
            idd = INT( bn(kkk,1) / w / asd(5) + 1 )
            if(idd < 1 .or. idd > n_bin_hist .OR. bn(kkk,1) < 1D-10) goto 404
            an(idd,5,kkk) = an(idd,5,kkk) + w/asd(5)
404         continue
!       mean pT, <pT>
!       multiplicity is located at which interval
            idf = INT( bnf(kkk,1) / w / asd(7) + 1 )
!       the 7-th distribution is mean pT VS. particle multiplicity distribution
            if( idf >= 1 .AND. idf <= n_bin_hist .AND. bnf(kkk,1) > 0D0 )then
                anf(idf,7,kkk) = anf(idf,7,kkk) + bnf(kkk,2) / w
                anf(idf,8,kkk) = anf(idf,8,kkk) + bnf(kkk,1) / w
            end if
            idd = INT( bn(kkk,1) / w / asd(7) + 1 )
            if( idd >= 1 .AND. idd <= n_bin_hist .AND. bn(kkk,1) > 0D0 )then
                an(idd,7,kkk) = an(idd,7,kkk) + bn(kkk,2) / w
                an(idd,8,kkk) = an(idd,8,kkk) + bn(kkk,1) / w
            end if
        end do

!       For total, charged and pi+K+p particles.
        do kkk=1,3,1
!       multiplicity is located at which interval
            idf = INT( dMult_f(kkk,1) / w / asd(5) + 1 )
!       the 5-th distribution is particle multiplicity distribution
            if( idf >= 1 .AND. idf <= n_bin_hist .AND. dMult_f(kkk,1) > 0D0 ) &
                distr_f(idf,5,kkk) = distr_f(idf,5,kkk) + w/asd(5)
            idd = INT( dMult(kkk,1) / w / asd(5) + 1 )
            if( idd >= 1 .AND. idd <= n_bin_hist .AND. dMult(kkk,1) > 0D0 ) &
                distr(idd,5,kkk) = distr(idd,5,kkk) + w/asd(5)
!       mean pT, <pT>
!       multiplicity is located at which interval
            idf = INT( dMult_f(kkk,1) / w / asd(7) + 1 )
!       the 7-th distribution is mean pT VS. particle multiplicity distribution
            if( idf >= 1 .AND. idf <= n_bin_hist .AND.dMult_f(kkk,1) > 0D0 )then
                distr_f(idf,7,kkk) = distr_f(idf,7,kkk) + dMult_f(kkk,2) / w
                distr_f(idf,8,kkk) = distr_f(idf,8,kkk) + dMult_f(kkk,1) / w
            end if
            idd = INT( dMult(kkk,1) / w / asd(7) + 1 )
            if( idd >= 1 .AND. idd <= n_bin_hist .AND. dMult(kkk,1) > 0D0 )then
                distr(idd,7,kkk) = distr(idd,7,kkk) + dMult(kkk,2) / w
                distr(idd,8,kkk) = distr(idd,8,kkk) + dMult(kkk,1) / w
            end if
        end do


        return
        end



!ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
        subroutine stati_h(y,pt,eta,p5,ik,kk,ww,a,af,b,bf)
!!      Online statistics for hh, hA(Ah) and AB collisions.
        IMPLICIT DOUBLE PRECISION(A-H, O-Z)
        IMPLICIT INTEGER(I-N)
        common/sa1/kjp21,non1,bp,iii,neve,nout,nosc
        common/sa7/ispmax,isdmax,iflmax,ispkf(100),n_bin_hist,asd(10), &
         afl(100,10,2),i_y_or_eta
        common/sa10/csnn,cspin,cskn,cspipi,cspsn,cspsm,rcsit,ifram, &
         iabsb,iabsm,i_sigma_AQM,ajpsi,csspn,csspm,csen
        dimension a(100,10,100),af(100,10,100),b(100,2),bf(100,2)
        dimension c(10),id(10)


!       Excludes particles with too small/zero pT.
        if( pt <= 1D-15 ) return
        kf = ik
        damass  = p5
        amass2 = damass*damass
        pt2 = pt*pt
        pmt = sqrt( pt2 + amass2 )
        c(1) = y
        if( i_y_or_eta == 1 ) c(1) = eta
        c(2) = pt
!       .
!       .
!       .
!       calculate the abscissa one by one
        mid_bin = n_bin_hist / 2
!       y is located in which interval?
        ii = INT( abs(y) / asd(1) + 1 )
        if( y > 0.) ii = ii + mid_bin
        if( y < 0.) ii = mid_bin - ii + 1
        id(1) = ii
!       pt is located in which interval? (inv. pT)
        id(2) = INT( pt / asd(2) + 1 )
!       eta is located in which interval?
        ii = INT( abs(eta) / asd(3) + 1 )
        if( eta > 0.) ii = ii + mid_bin
        if( eta < 0.) ii = mid_bin - ii + 1
        id(3) = ii
!       mt is counted in which mt interval ?
        id(4) = INT( pmt / asd(4) + 1 )
!       pt is located in which interval? (dN/dpT)
        id(6) = INT( pt / asd(6) + 1 )

!       make statistics of particle yield, mean pT, and desired distributions
!        in full space.
        bf(kk,1) = bf(kk,1) + ww
        bf(kk,2) = bf(kk,2) + ww*pt
        do i=1,isdmax,1
            ii = id(i)
            if( ii < 1 .or. ii > n_bin_hist ) cycle
            ! dN/dy
            if(i == 1) af(ii,i,kk) = af(ii,i,kk) + ww/asd(i)
            ! (1/pT)dN/dpT
            if(i == 2) af(ii,i,kk) = af(ii,i,kk) + ww/asd(i)/pt
            ! dN/deta
            if(i == 3) af(ii,i,kk) = af(ii,i,kk) + ww/asd(i)
            ! (1/mT)dN/dmT
            if(i == 4) af(ii,i,kk) = af(ii,i,kk) + ww/asd(i)/pmt
            ! dN/dpT
            if(i == 6) af(ii,i,kk) = af(ii,i,kk) + ww/asd(i)
        enddo

!       if(iflmax == 0)return

!       make statistics for desired distributions in partial space
        do i=1,isdmax,1
            ii = id(i)
            if( ii < 1 .or. ii > n_bin_hist ) cycle
            ! pT cut
            if( c(2) >= afl(kk,2,1) .AND. c(2) <= afl(kk,2,2) )then
                ! dN/dy
                if(i == 1) a(ii,i,kk) = a(ii,i,kk) + ww/asd(i)
                ! dN/deta
                if(i == 3) a(ii,i,kk) = a(ii,i,kk) + ww/asd(i)
            endif
            ! y/eta cut
            if( c(1) >= afl(kk,1,1) .AND. c(1) <= afl(kk,1,2) )then
                ! (1/pT)dN/dpT
                if(i == 2) a(ii,i,kk) = a(ii,i,kk) + ww/asd(i)/pt
                ! (1/mT)dN/dmT
                if(i == 4) a(ii,i,kk) = a(ii,i,kk) + ww/asd(i)/pmt
                ! dN/dpT
                if(i == 6) a(ii,i,kk) = a(ii,i,kk) + ww/asd(i)
            endif
        enddo

!       put the filter to be effective
!       do i=1,iflmax
!           if( c(i) < afl(kk,i,1) .or. c(i) > afl(kk,i,2) ) return
!       enddo

!       make statistics for particle yield and mean pT in partial space

        ! pT & y/eta cut
        if( c(2) >= afl(kk,2,1) .AND. c(2) <= afl(kk,2,2) .AND. &
            c(1) >= afl(kk,1,1) .AND. c(1) <= afl(kk,1,2) )then
            b(kk,1) = b(kk,1) + ww
            b(kk,2) = b(kk,2) + ww*pt
        end if


        return
        end



!ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
        subroutine stati_l(p1,p2,p3,p4,p5,ik,kk,ww,a,af,b,bf)
!!      Online statistics for case of the lepton incuced scattering.
        IMPLICIT DOUBLE PRECISION(A-H, O-Z)
        IMPLICIT INTEGER(I-N)
        common/sa7/ispmax,isdmax,iflmax,ispkf(100),n_bin_hist,asd(10), &
         afl(100,10,2),i_y_or_eta
        common/sa10/csnn,cspin,cskn,cspipi,cspsn,cspsm,rcsit,ifram, &
         iabsb,iabsm,i_sigma_AQM,ajpsi,csspn,csspm,csen
        common/sa21/pincl(5),pscal(5),pinch(5),vnu,fq2,w2l,yyl,zl,xb, &
         pph,vnlep
        dimension a(100,10,100),af(100,10,100),b(100,2),bf(100,2)
        dimension c(10),id(10)
!       vnu: \nu; fq2: Q^2=-q^2; w2l: W^2; yyl: y; zl: z; xb: x_B; pph: P_h
!       calculate kinematic variable relevant to the produced hadron


        dm=p5
        kf=ik
        pph=p1*p1+p2*p2+p3*p3
        pph=dmax1(pph,1.d-20)
        pph=dsqrt(pph)
        ! numerator of z
        zln=pinch(4)*p4-pinch(1)*p1-pinch(2)*p2-pinch(3)*p3
        ! denominator of z
        zld=pinch(5)*vnu
        zld=dmax1(zld,1.d-20)
        zl=zln/zld
        ! -q^2
        c(1)=fq2
        ! W^2
        c(2)=w2l
        ! y
        c(3)=yyl
        ! p_h
        c(4)=pph
        ! z
        c(5)=zl
!       calculate the abscissa one by one
!       z is located in which interval?
        id(1) =  INT( zl/asd(1)+1 )
!       \nu is located in which interval?
        id(2) =  INT( vnu/asd(2)+1 )
!       -q^2 is located in which interval?
        id(3) = INT( fq2/asd(3)+1 )
!       make statistics of particle yield and desired distributions
        bf(kk,1)=bf(kk,1)+ww
        do i=1,isdmax
            ii=id(i)
            if( ii < 1 .or. ii > n_bin_hist ) cycle
            if(i == 1) af(ii,i,kk)=af(ii,i,kk)+ww/asd(i)
            if(i == 2) af(ii,i,kk)=af(ii,i,kk)+ww/asd(i)
            if(i == 3) af(ii,i,kk)=af(ii,i,kk)+ww/asd(i)
        enddo
!       put kinematic constraints to be effective
        do i=1,iflmax
            if( c(i) < afl(kk,i,1) .or. c(i) > afl(kk,i,2) ) return
        enddo
!       make statistics of particle yield and desired distributions
        b(kk,1)=b(kk,1)+ww
        do i=1,isdmax,1
            ii=id(i)
            if( ii < 1 .or. ii > n_bin_hist ) cycle
            if(i == 1) a(ii,i,kk)=a(ii,i,kk)+ww/asd(i)
            if(i == 2) a(ii,i,kk)=a(ii,i,kk)+ww/asd(i)
            if(i == 3) a(ii,i,kk)=a(ii,i,kk)+ww/asd(i)
        enddo


        return
        end



!ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
        subroutine stati_particle(y,pt,eta,p5,charge,kf,ww)
!!      Special subroutine for total, charged and pi+K+p.
!!      Online statistics for hh, hA(Ah) and AB collisions.
!!      Uses the nominal cuts of 1-st setting in usu.dat.
        IMPLICIT DOUBLE PRECISION(A-H, O-Z)
        IMPLICIT INTEGER(I-N)
        common/sa1/kjp21,non1,bp,iii,neve,nout,nosc
        common/sa7/ispmax,isdmax,iflmax,ispkf(100),n_bin_hist,asd(10), &
         afl(100,10,2),i_y_or_eta
        common/anly4/ distr(100,10,5), dMult(5,2), distr_f(100,10,5),&
         dMult_f(5,2), san_distr(100,10,5), sbn_mult(5,2),&
         san_distr_f(100,10,5), sbn_mult_f(5,2), sao_distr(100,10,5),&
         sbo_mult(5,2), sao_distr_f(100,10,5), sbo_mult_f(5,2)
        dimension c(10),id(10)


!       Excludes particles with too small/zero pT.
        if( pt <= 1D-15 ) return
        kfabs  = ABS(kf)
        damass  = p5
        amass2 = damass*damass
        pt2    = pt*pt
        pmt    = sqrt( pt2 + amass2 )
        c(1) = y
        if( i_y_or_eta == 1 ) c(1) = eta
        c(2) = pt
!       .
!       .
!       .
!       Calculate the abscissa one by one.
!       y is located in which interval?
        id = 0
        mid_bin = n_bin_hist / 2
        ii = INT( ABS(y) / asd(1) + 1 )
        if( y >= 0D0 ) ii = ii + mid_bin
        if( y <  0D0 ) ii = mid_bin - ii + 1
        id(1) = ii
!       pt is located in which interval? (inv. pT)
        id(2) = INT( pt / asd(2) + 1 )
!       eta is located in which interval?
        ii = INT( ABS(eta) / asd(3) + 1 )
        if( eta >= 0D0 ) ii = ii + mid_bin
        if( eta <  0D0 ) ii = mid_bin - ii + 1
        id(3) = ii
!       mt is counted in which mt interval ?
        id(4) = INT( pmt / asd(4) + 1 )
!       pt is located in which interval? (dN/dpT)
        id(6) = INT( pt / asd(6) + 1 )

!       Make statistics of particle yield, mean pT, and desired distributions
!        in full space.
!       All particles.
        dMult_f(1,1) = dMult_f(1,1) + ww
        dMult_f(1,2) = dMult_f(1,2) + ww*pt
!       Charged particles.
        if( ABS(charge-0D0) > 1D-5 )then
            dMult_f(2,1) = dMult_f(2,1) + ww
            dMult_f(2,2) = dMult_f(2,2) + ww*pt
!       pi+K+p particles.
            if( kfabs == 2212 .OR. kfabs == 321 .OR. kfabs == 211 )then
                dMult_f(3,1) = dMult_f(3,1) + ww
                dMult_f(3,2) = dMult_f(3,2) + ww*pt
            end if
        end if

        do i=1,isdmax,1
            ii = id(i)
            if( ii < 1 .or. ii > n_bin_hist ) cycle
!       All particles.
            ! dN/dy
            if(i == 1) distr_f(ii,i,1) = distr_f(ii,i,1) + ww/asd(i)
            ! (1/pT)dN/dpT
            if(i == 2) distr_f(ii,i,1) = distr_f(ii,i,1) + ww/asd(i)/pt
            ! dN/deta
            if(i == 3) distr_f(ii,i,1) = distr_f(ii,i,1) + ww/asd(i)
            ! (1/mT)dN/dmT
            if(i == 4) distr_f(ii,i,1) = distr_f(ii,i,1) + ww/asd(i)/pmt
            ! dN/dpT
            if(i == 6) distr_f(ii,i,1) = distr_f(ii,i,1) + ww/asd(i)
!       Charged particles.
            if( ABS(charge) > 1D-5 )then
                ! dN/dy
                if(i == 1) distr_f(ii,i,2)=distr_f(ii,i,2)+ww/asd(i)
                ! (1/pT)dN/dpT
                if(i == 2) distr_f(ii,i,2)=distr_f(ii,i,2)+ww/asd(i)/pt
                ! dN/deta
                if(i == 3) distr_f(ii,i,2)=distr_f(ii,i,2)+ww/asd(i)
                ! (1/mT)dN/dmT
                if(i == 4) distr_f(ii,i,2)=distr_f(ii,i,2)+ww/asd(i)/pmt
                ! dN/dpT
                if(i == 6) distr_f(ii,i,2)=distr_f(ii,i,2)+ww/asd(i)
!       pi+K+p
                if( kfabs == 2212 .OR. kfabs == 321 .OR. kfabs == 211 )then
                    ! dN/dy
                    if(i == 1) distr_f(ii,i,3)=distr_f(ii,i,3)+ww/asd(i)
                    ! (1/pT)dN/dpT
                    if(i == 2) distr_f(ii,i,3)=distr_f(ii,i,3)+ww/asd(i)/pt
                    ! dN/deta
                    if(i == 3) distr_f(ii,i,3)=distr_f(ii,i,3)+ww/asd(i)
                    ! (1/mT)dN/dmT
                    if(i == 4) distr_f(ii,i,3)=distr_f(ii,i,3)+ww/asd(i)/pmt
                    ! dN/dpT
                    if(i == 6) distr_f(ii,i,3)=distr_f(ii,i,3)+ww/asd(i)
                end if
            end if
        end do

!       Make statistics for desired distributions in partial space.
!       Use the nominal cuts of 1-st setting in usu.dat.
        do i=1,isdmax,1
            ii = id(i)
            if( ii < 1 .or. ii > n_bin_hist ) cycle
!       pT cut. Note (1,*,*) here.
            if( c(2) >= afl(1,2,1) .AND. c(2) <= afl(1,2,2) )then
!       All particles.
                ! dN/dy
                if(i == 1) distr(ii,i,1) = distr(ii,i,1) + ww/asd(i)
                ! dN/deta
                if(i == 3) distr(ii,i,1) = distr(ii,i,1) + ww/asd(i)
!       Charged particles.
                if( ABS(charge-0.) > 1D-5 )then
                    ! dN/dy
                    if(i == 1) distr(ii,i,2) = distr(ii,i,2) + ww/asd(i)
                    ! dN/deta
                    if(i == 3) distr(ii,i,2) = distr(ii,i,2) + ww/asd(i)
!       pi+K+p
                    if( kfabs == 2212 .OR. kfabs == 321 .OR. kfabs == 211)then
                        ! dN/dy
                        if(i == 1) distr(ii,i,3) = distr(ii,i,3) + ww/asd(i)
                        ! dN/deta
                        if(i == 3) distr(ii,i,3) = distr(ii,i,3) + ww/asd(i)
                    end if
                end if
            end if
!       y/eta cut. Note (1,*,*) here.
            if( c(1) >= afl(1,1,1) .AND. c(1) <= afl(1,1,2) )then
!       All particles.
                ! (1/pT)dN/dpT
                if(i == 2) distr(ii,i,1) = distr(ii,i,1) + ww/asd(i)/pt
                ! (1/mT)dN/dmT
                if(i == 4) distr(ii,i,1) = distr(ii,i,1) + ww/asd(i)/pmt
                ! dN/dpT
                if(i == 6) distr(ii,i,1) = distr(ii,i,1) + ww/asd(i)
!       Charged particles.
                if( ABS(charge-0.) > 1D-5 )then
                    ! (1/pT)dN/dpT
                    if(i == 2) distr(ii,i,2)=distr(ii,i,2)+ww/asd(i)/pt
                    ! (1/mT)dN/dmT
                    if(i == 4) distr(ii,i,2)=distr(ii,i,2)+ww/asd(i)/pmt
                    ! dN/dpT
                    if(i == 6) distr(ii,i,2)=distr(ii,i,2)+ww/asd(i)
!       pi+K+p
                    if( kfabs == 2212 .OR. kfabs == 321 .OR. kfabs == 211)then
                        ! (1/pT)dN/dpT
                        if(i == 2) distr(ii,i,3)=distr(ii,i,3)+ww/asd(i)/pt
                        ! (1/mT)dN/dmT
                        if(i == 4) distr(ii,i,3)=distr(ii,i,3)+ww/asd(i)/pmt
                        ! dN/dpT
                        if(i == 6) distr(ii,i,3)=distr(ii,i,3)+ww/asd(i)
                    end if
                end if
            end if
        end do

!       Make statistics for particle yield and mean pT in partial space
!        (use the first filter set) .

!       pT and y/eta cuts. Note (1,*,*) here.
        if( c(2) >= afl(1,2,1) .AND. c(2) <= afl(1,2,2) .AND. &
            c(1) >= afl(1,1,1) .AND. c(1) <= afl(1,1,2) )then
!       All particles.
            dMult(1,1) = dMult(1,1) + ww
            dMult(1,2) = dMult(1,2) + ww*pt
!       Charged particles.
            if( ABS(charge-0.) > 1D-5 )then
                dMult(2,1) = dMult(2,1) + ww
                dMult(2,2) = dMult(2,2) + ww*pt
!       pi+K+p particles.
            if( kfabs == 2212 .OR. kfabs == 321 .OR. kfabs == 211 )then
                dMult(3,1) = dMult(3,1) + ww
                dMult(3,2) = dMult(3,2) + ww*pt
            end if
            end if
        end if


        return
        end



!ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
        subroutine analy_parton(wgt,sum_wgt)
!!      Analyses an event based on the messages in "oscar2".
!!      Uses the nominal cuts of 1-st setting in usu.dat for partons.
        IMPLICIT DOUBLE PRECISION(A-H, O-Z)
        IMPLICIT INTEGER(I-N)
        LOGICAL IS_EXIST,IS_PARTON,IS_DIQUARK
        PARAMETER (KSZJ=80000)
        ! Note name here
        COMMON/PYJETS/NPYJ,NPADPYJ,KPYJ(KSZJ,5),PPYJ(KSZJ,5),VPYJ(KSZJ,5)
        ! Note name here
        COMMON/oscar2/N,NPAD,K(KSZJ,5),P(KSZJ,5),V(KSZJ,5)
        common/sa1/kjp21,non1,bp,iii,neve,nout,nosc
        common/sa7/ispmax,isdmax,iflmax,ispkf(100),n_bin_hist,asd(10), &
         afl(100,10,2),i_y_or_eta
        common/sa24/adj1(40),nnstop,non24,zstop
        common/syspar/ipden,itden,suppm,suptm,suppc,suptc,r0p,r0t, &
         nap,nat,nzp,nzt,pio
        COMMON/SA1_PY8/ i_mode, i_tune, KF_woDecay(100), &
               KF_proj, KF_targ, win, energy_B, psno, b_min, b_max
!       For parton.
!       u, ubar, d, dbar, s, sbar, c, cbar, b, bbar, t, tbar, g, (u+d+s + anti-)
        common/anly2/ sn_min_p, sn_min_p_f, sn_cha_p, sn_cha_p_f, sn_g, &
                      sn_g_f,san_p(100,10,20), sbn_p(20,2), &
                      san_p_f(100,10,20),      sbn_p_f(20,2)
        common/anly2_2/ an_p(100,10,20), an_p_f(100,10,20), &
                        bn_p(20,2), bn_p_f(20,2)
        common/ flow_p / snum_p_integral(20,2),   &
                         flow_p_integral(20,4,2), &
                         dNy_p_f(100,20),      &
                         dNy_p(100,20),        &
                         dNpT_p_f(100,20),     &
                         dNpT_p(100,20),       &
                         dNeta_p_f(100,20),    &
                         dNeta_p(100,20),      &
                         dvdy_p_f(100,4,20),   &
                         dvdy_p(100,4,20),     &
                         dvdpT_p_f(100,4,20),  &
                         dvdpT_p(100,4,20),    &
                         dvdeta_p_f(100,4,20), &
                         dvdeta_p(100,4,20)
        dimension c(10)


!       wgt (sum_wgt): weight (total weight) of the current (total) event.
!          Normally = 1 (Neve), but non-one (non-Neve) for the biased event.

!       bn(i) (bnf(i)): multiplicity of i-th particle in partial (full)
!        phase space
!       an(l,i,j) (anf(l,i,j)): three dimension array in partial (full)
!         phase space
!       l: order # of y (pt, eta, ...) interval
!       i: kind of distribution
!       for pp, NA,AN and AB collisions
!        i=1: for y
!        i=2: for pt (inv. pT)
!        i=3: for eta
!        i=4: for mT
!        i=5: for event-wise multiplicity
!        i=6: for pT (dN/dpT)
!       j: order # of particle in array of 'ispkf' (1 to ispmax)
!       isdmax: maximum # of distributions considered
!       asd(i): interval segmented for i-th distribution
!       iflmax: maximum # of windows, =0 means no window at all
!       afl(j,i,1): lower bound of i-th window for j-th particle
!       afl(j,i,2): upper bound of i-th window for j-th particle
!       for pp,NA,AN and AB collisions
!        i=1: y/eta window (depends on i_y_or_eta)
!        i=2: pt window
!         .        .
!         .        .
!         .        .
!       i_y_or_eta: select y or eta in partial phase-space statistics.
!                 = 0 , y
!                 = 1 , eta

!       Largest momentum allowed for particle
        dpmax = adj1(27)

!       Initializes the variales
        dn_min_p   = 0D0
        dn_min_p_f = 0D0
        dn_cha_p   = 0D0
        dn_cha_p_f = 0D0
        dn_g       = 0D0
        dn_g_f     = 0D0
        bn_p   = 0D0
        bn_p_f = 0D0
        an_p   = 0D0
        an_p_f = 0D0
        if(iii == 1)then
            sn_min_p   = 0D0
            sn_min_p_f = 0D0
            sn_cha_p   = 0D0
            sn_cha_p_f = 0D0
            sn_g       = 0D0
            sn_g_f     = 0D0
            sbn_p   = 0D0
            sbn_p_f = 0D0
            san_p   = 0D0
            san_p_f = 0D0
            ! For flow.
            snum_p_integral = 0D0
            flow_p_integral = 0D0
            dNy_p_f = 0D0
            dNy_p = 0D0
            dNpT_p_f = 0D0
            dNpT_p = 0D0
            dNeta_p_f = 0D0
            dNeta_p = 0D0
            dvdy_p_f = 0D0
            dvdy_p = 0D0
            dvdpT_p_f = 0D0
            dvdpT_p = 0D0
            dvdeta_p_f = 0D0
            dvdeta_p = 0D0
        end if

!       Analyses an event inside /oscar2/.
        do j=1,N,1
!       Exclude historical and non-parton entries.
            KS = K(j,1)
            KF = K(j,2)
            if( .NOT.IS_EXIST(KS,i_mode) .OR. .NOT.IS_PARTON(KF) ) cycle
            ! To use the "PAPYP" function in Pythia8_fort_interface.f90.
            do i=1,5,1
                KPYJ( NPYJ+1, i ) = K(j,i)
                PPYJ( NPYJ+1, i ) = P(j,i)
                VPYJ( NPYJ+1, i ) = V(j,i)
            end do
            charge = PAPYP( NPYJ+1, 6 )
            eta    = PAPYP( NPYJ+1, 19 )
            w    = 1D0
            ! w  = wgt
            swgt = sum_wgt
            p1   = P(j,1)
            p2   = P(j,2)
            p3   = P(j,3)
            p4   = P(j,4)
            p5   = P(j,5)
            ppt  = PAPYP( NPYJ+1, 10 )
            yy   = PAPYP( NPYJ+1, 17 )
            ppm  = SQRT( p1*p1 + p2*p2 + p3*p3 )
            if( ppm > dpmax .or. p4 > dpmax ) cycle
            ! For pp, pA (Ap) & AB
            if( ipden < 11 )then
                c(1) = yy
                if( i_y_or_eta == 1 ) c(1) = eta
                c(2) = ppt
!               .
!               .
!               .
!               Statistics of negative multiplicity
                ! For partons, -chaege
                if( charge < -0.2 )then
                    dn_min_p_f = dn_min_p_f + w
                    do i=1,iflmax,1
                        if( c(i) < afl(1,i,1) .or. c(i) > afl(1,i,2) ) goto 702
                    end do
                    dn_min_p = dn_min_p + w
702             end if
!               Statistics of positive multiplicity
                ! For partons, +chaege
                if( charge > 0.2 )then
                    dn_cha_p_f = dn_cha_p_f + w
                    do i=1,iflmax,1
                        if( c(i) < afl(1,i,1) .or. c(i) > afl(1,i,2) ) goto 703
                    end do
                    dn_cha_p = dn_cha_p + w
703             end if
!               Statistics of gluon multiplicity
                if( kf == 21 )then
                    dn_g_f = dn_g_f + w
                    do i=1,iflmax,1
                        if( c(i) < afl(1,i,1) .or. c(i) > afl(1,i,2) ) goto 704
                    end do
                    dn_g = dn_g + w
704             end if
            end if
!           g, (u+d+s + anti-), u, ubar, d, dbar, s,sbar, c,cbar, b,bbar, t,tbar
            kk = 0
            select case(kf)
            case(21)
                kk = 1
            ! case ABS( 1~3 )
            !     kk = 2
            case(2)
                kk = 3
            case(-2)
                kk = 4
            case(1)
                kk = 5
            case(-1)
                kk = 6
            case(3)
                kk = 7
            case(-3)
                kk = 8
            case(4)
                kk = 9
            case(-4)
                kk = 10
            case(5)
                kk = 11
            case(-5)
                kk = 12
            case(6)
                kk = 13
            case(-6)
                kk = 14
            end select
            ! Diquark.
            if( IS_DIQUARK(kf) ) kk = 15
!           Analyses for pp,pA and AB
            if( kk > 0 )then
                call stati_parton( yy, ppt, eta, p5, kf, kk, w )
                call flow_parton( p1, p2, yy, ppt, eta, kf, kk, w )
            end if
        end do

!       Statistics of multiplicity distributions
        do kkk=1,15,1
!           Multiplicity is located at which interval
            idf = INT( bn_p_f(kkk,1) / w /asd(5) + 1 )
!           The 5-th distribution is particle multiplicity distribution
            if( idf >= 1 .AND. idf <= n_bin_hist .AND. bn_p_f(kkk,1) > 1D-10 ) &
                an_p_f(idf,5,kkk) = an_p_f(idf,5,kkk) + w/asd(5)
!           Use the nominal cuts of 1-st setting in usu.dat for partons.
            idd = INT( bn_p(kkk,1) / w /asd(5) + 1 )
            if( idd >= 1 .AND. idd <= n_bin_hist .AND. bn_p(kkk,1) > 1D-10 ) &
                an_p(idd,5,kkk) = an_p(idd,5,kkk) + w/asd(5)
!           mean pT, <pT>
!           Multiplicity is located at which interval
            idf = INT( bn_p_f(kkk,1) / w /asd(7) + 1 )
!           The 7-th distribution is mean pT VS. particle multi. distribution
            if( idf >= 1 .AND. idf <= n_bin_hist .AND. bn_p_f(kkk,1) > 0D0 )then
                an_p_f(idf,7,kkk) = an_p_f(idf,7,kkk) + bn_p_f(kkk,2) / w
                an_p_f(idf,8,kkk) = an_p_f(idf,8,kkk) + bn_p_f(kkk,1) / w
            end if
            idd = INT( bn_p(kkk,1) / w /asd(7) + 1 )
            if( idd >= 1 .AND. idd <= n_bin_hist .AND. bn_p(kkk,1) > 0D0 )then
                an_p(idd,7,kkk) = an_p(idd,7,kkk) + bn_p(kkk,2) / w
                an_p(idd,8,kkk) = an_p(idd,8,kkk) + bn_p(kkk,1) / w
            end if
        end do


!       Event accumulation. Note wgt here, not w.
        sn_min_p   = sn_min_p   + dn_min_p   * wgt
        sn_min_p_f = sn_min_p_f + dn_min_p_f * wgt
        sn_cha_p   = sn_cha_p   + dn_cha_p   * wgt
        sn_cha_p_f = sn_cha_p_f + dn_cha_p_f * wgt
        sn_g       = sn_g       + dn_g       * wgt
        sn_g_f     = sn_g_f     + dn_g_f     * wgt

        sbn_p   = sbn_p   + bn_p   * wgt
        sbn_p_f = sbn_p_f + bn_p_f * wgt
        ! san_p   = san_p   + an_p   * wgt
        ! san_p_f = san_p_f + an_p_f * wgt
        do kk=1,20,1
            do jj=1,10,1
                real_wgt = wgt
                if( jj == 7 .OR. jj == 8 ) real_wgt = 1D0
                do ii=1,100,1
                    san_p(ii,jj,kk)   = san_p(ii,jj,kk)   &
                                      + an_p(ii,jj,kk)    * real_wgt
                    san_p_f(ii,jj,kk) = san_p_f(ii,jj,kk) &
                                      + an_p_f(ii,jj,kk)  * real_wgt
                end do
            end do
        end do


        return
        end



!ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
        subroutine stati_parton(y,pt,eta,p5,kf,kk,ww)
!!      Online statistics of partons for hh, hA(Ah) and AB collisions.
!!      Use the nominal cuts of 1-st setting in usu.dat for partons.
        IMPLICIT DOUBLE PRECISION(A-H, O-Z)
        IMPLICIT INTEGER(I-N)
        common/sa1/kjp21,non1,bp,iii,neve,nout,nosc
        common/sa7/ispmax,isdmax,iflmax,ispkf(100),n_bin_hist,asd(10), &
         afl(100,10,2),i_y_or_eta
        common/anly2_2/ a(100,10,20), af(100,10,20), &
                        b(20,2), bf(20,2)
        dimension c(10), id(10)


        ! Excludes particles with too small/zero pT.
        if( pt <= 1D-15 ) return
        damass  = p5
        amass2 = damass*damass
        pt2    = pt*pt
        pmt    = sqrt( pt2 + amass2 )
        c(1) = y
        if( i_y_or_eta == 1 ) c(1) = eta
        c(2) = pt
!       .
!       .
!       .
!       Calculate the abscissa one by one.
!       y is located in which interval?
        id = 0
        mid_bin = n_bin_hist / 2
        ii = INT( ABS(y) / asd(1) + 1 )
        if( y >= 0. ) ii = ii + mid_bin
        if( y <  0. ) ii = mid_bin - ii + 1
        id(1) = ii
!       pt is located in which interval? (inv. pT)
        id(2) = INT( pt / asd(2) + 1 )
!       eta is located in which interval?
        ii = INT( ABS(eta) / asd(3) + 1 )
        if( eta >= 0. ) ii = ii + mid_bin
        if( eta <  0. ) ii = mid_bin - ii + 1
        id(3) = ii
!       mt is counted in which mt interval ?
        id(4) = INT( pmt/asd(4) + 1 )
!       pt is located in which interval? (dN/dpT)
        id(6) = INT( pt/asd(6) + 1 )

!       Makes statistics of particle yield, mean pT and desired distributions
!        in full space.
        bf(kk,1) = bf(kk,1) + ww
        bf(kk,2) = bf(kk,2) + ww*pt
        if( ABS(kf) >= 1 .AND. ABS(kf) <= 3 )then
            bf(2,1) = bf(2,1) + ww
            bf(2,2) = bf(2,2) + ww*pt
        end if
        do i=1,isdmax,1
            ii = id(i)
            if( ii < 1 .or. ii > n_bin_hist ) cycle
            ! dN/dy
            if(i == 1) af(ii,i,kk) = af(ii,i,kk) + ww/asd(i)
            ! (1/pT)dN/dpT
            if(i == 2) af(ii,i,kk) = af(ii,i,kk) + ww/asd(i)/pt
            ! dN/deta
            if(i == 3) af(ii,i,kk) = af(ii,i,kk) + ww/asd(i)
            ! (1/mT)dN/dmT
            if(i == 4) af(ii,i,kk) = af(ii,i,kk) + ww/asd(i)/pmt
            ! dN/dpT
            if(i == 6) af(ii,i,kk) = af(ii,i,kk) + ww/asd(i)
            ! u+d+s + anti-
            if( ABS(kf) >= 1 .AND. ABS(kf) <= 3 )then
                ! dN/dy
                if(i == 1) af(ii,i,2) = af(ii,i,2) + ww/asd(i)
                ! (1/pT)dN/dpT
                if(i == 2) af(ii,i,2) = af(ii,i,2) + ww/asd(i)/pt
                ! dN/deta
                if(i == 3) af(ii,i,2) = af(ii,i,2) + ww/asd(i)
                ! (1/mT)dN/dmT
                if(i == 4) af(ii,i,2) = af(ii,i,2) + ww/asd(i)/pmt
                ! dN/dpT
                if(i == 6) af(ii,i,2) = af(ii,i,2) + ww/asd(i)
            end if
        end do

!       Make statistics for desired distributions in partial space
!       Uses the nominal cuts of 1-st setting in usu.dat for partons.
        do i=1,isdmax,1
            ii=id(i)
            if( ii < 1 .or. ii > n_bin_hist ) cycle
!       pT cut. Note (1,*,*) here.
            ! pT cut
            if( c(2) >= afl(1,2,1) .AND. c(2) <= afl(1,2,2) )then
                ! dN/dy
                if(i == 1) a(ii,i,kk) = a(ii,i,kk) + ww/asd(i)
                ! dN/deta
                if(i == 3) a(ii,i,kk) = a(ii,i,kk) + ww/asd(i)
                if( ABS(kf) >= 1 .AND. ABS(kf) <= 3 )then
                    ! dN/dy
                    if(i == 1) a(ii,i,2) = a(ii,i,2) + ww/asd(i)
                    ! dN/deta
                    if(i == 3) a(ii,i,2) = a(ii,i,2) + ww/asd(i)
                end if
            end if
!       y/eta cut. Note (1,*,*) here.
            ! y/eta cut
            if( c(1) >= afl(1,1,1) .AND. c(1) <= afl(1,1,2) )then
                ! (1/pT)dN/dpT
                if(i == 2) a(ii,i,kk) = a(ii,i,kk) + ww/asd(i)/pt
                ! (1/mT)dN/dmT
                if(i == 4) a(ii,i,kk) = a(ii,i,kk) + ww/asd(i)/pmt
                ! dN/dpT
                if(i == 6) a(ii,i,kk) = a(ii,i,kk) + ww/asd(i)
                if( ABS(kf) >= 1 .AND. ABS(kf) <= 3 )then
                    if(i == 2) a(ii,i,2) = a(ii,i,2) + ww/asd(i)/pt
                    if(i == 4) a(ii,i,2) = a(ii,i,2) + ww/asd(i)/pmt
                    if(i == 6) a(ii,i,2) = a(ii,i,2) + ww/asd(i)
                end if
            end if
        end do

!       Make statistics for particle yield and mean pT in partial space
!        (use the first filter set) .

!       pT and y/eta cuts. Note (1,*,*) here.
        if( c(2) >= afl(1,2,1) .AND. c(2) <= afl(1,2,2) .AND. &
            c(1) >= afl(1,1,1) .AND. c(1) <= afl(1,1,2) )then
            b(kk,1) = b(kk,1) + ww
            b(kk,2) = b(kk,2) + ww*pt
            if( ABS(kf) >= 1 .AND. ABS(kf) <= 3 )then
                b(2,1) = b(2,1) + ww
                b(2,2) = b(2,2) + ww*pt
            end if
        end if


        return
        end



!ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
        subroutine flow_hadron( px, py, y, pT, eta, kk, ww )
!!      Calculates anisotropic flows of hadrons for hh, hA(Ah) & AB collisions.
        IMPLICIT DOUBLE PRECISION(A-H, O-Z)
        IMPLICIT INTEGER(I-N)
        common/sa1/kjp21,non1,bp,iii,neve,nout,nosc
        common/sa7/ispmax,isdmax,iflmax,ispkf(100),n_bin_hist,asd(10), &
         afl(100,10,2),i_y_or_eta
        common/ flow_h / snum_h_integral(100,2),   &
                         flow_h_integral(100,4,2), &
                         dNy_h_f(100,100),      &
                         dNy_h(100,100),        &
                         dNpT_h_f(100,100),     &
                         dNpT_h(100,100),       &
                         dNeta_h_f(100,100),    &
                         dNeta_h(100,100),      &
                         dvdy_h_f(100,4,100),   &
                         dvdy_h(100,4,100),     &
                         dvdpT_h_f(100,4,100),  &
                         dvdpT_h(100,4,100),    &
                         dvdeta_h_f(100,4,100), &
                         dvdeta_h(100,4,100)
        dimension c(10), id(10)


!       Excludes particles with too small/zero pT.
        if( pT <= 1D-15 ) return
        c(1) = y
        if( i_y_or_eta == 1 ) c(1) = eta
        c(2) = pt
!       .
!       .
!       .
!       Calculate the abscissa one by one.
!       y is located in which interval?
        id = 0
        mid_bin = n_bin_hist / 2
        ii = INT( ABS(y) / asd(1) + 1 )
        if( y >= 0. ) ii = ii + mid_bin
        if( y <  0. ) ii = mid_bin - ii + 1
        id(1) = ii
!       pT is located in which interval?
        id(2) = INT( pt / asd(2) + 1 )
!       eta is located in which interval?
        ii = INT( ABS(eta) / asd(3) + 1 )
        if( eta >= 0. ) ii = ii + mid_bin
        if( eta <  0. ) ii = mid_bin - ii + 1
        id(3) = ii

!       Flow components.
        v1 = px / pT
        v2 = ( px**2 - py**2 ) / pT**2
        v3 = ( px**3 - 3D0 * px * py**2 ) / pT**3
        v4 = ( px**4 - 6D0 * px**2 * py**2 + py**4 ) / pT**4

!       Flow in the full space (without cuts).

!       Integral flow.
        snum_h_integral(kk,1)   = snum_h_integral(kk,1)   + ww
        flow_h_integral(kk,1,1) = flow_h_integral(kk,1,1) + v1
        flow_h_integral(kk,2,1) = flow_h_integral(kk,2,1) + v2
        flow_h_integral(kk,3,1) = flow_h_integral(kk,3,1) + v3
        flow_h_integral(kk,4,1) = flow_h_integral(kk,4,1) + v4
!       Differential flow.
        ! dv/dy
        ii = id(1)
        if( ii >= 1 .AND. ii <= n_bin_hist )then
            dNy_h_f(ii,kk)    = dNy_h_f(ii,kk)    + ww
            dvdy_h_f(ii,1,kk) = dvdy_h_f(ii,1,kk) + v1
            dvdy_h_f(ii,2,kk) = dvdy_h_f(ii,2,kk) + v2
            dvdy_h_f(ii,3,kk) = dvdy_h_f(ii,3,kk) + v3
            dvdy_h_f(ii,4,kk) = dvdy_h_f(ii,4,kk) + v4
        end if
        ! dv/dpT
        ii = id(2)
        if( ii >= 1 .AND. ii <= n_bin_hist )then
            dNpT_h_f(ii,kk)    = dNpT_h_f(ii,kk)    + ww
            dvdpT_h_f(ii,1,kk) = dvdpT_h_f(ii,1,kk) + v1
            dvdpT_h_f(ii,2,kk) = dvdpT_h_f(ii,2,kk) + v2
            dvdpT_h_f(ii,3,kk) = dvdpT_h_f(ii,3,kk) + v3
            dvdpT_h_f(ii,4,kk) = dvdpT_h_f(ii,4,kk) + v4
        end if
        ! dv/deta
        ii = id(3)
        if( ii >= 1 .AND. ii <= n_bin_hist )then
            dNeta_h_f(ii,kk)    = dNeta_h_f(ii,kk)    + ww
            dvdeta_h_f(ii,1,kk) = dvdeta_h_f(ii,1,kk) + v1
            dvdeta_h_f(ii,2,kk) = dvdeta_h_f(ii,2,kk) + v2
            dvdeta_h_f(ii,3,kk) = dvdeta_h_f(ii,3,kk) + v3
            dvdeta_h_f(ii,4,kk) = dvdeta_h_f(ii,4,kk) + v4
        end if

!       Flow in the partial space (with cuts).

!       pT & y/eta cuts. Note (1,*,*) here.
        if( c(2) >= afl(kk,2,1) .AND. c(2) <= afl(kk,2,2) .AND. &
            c(1) >= afl(kk,1,1) .AND. c(1) <= afl(kk,1,2) )then
!       Integral flow.
            snum_h_integral(kk,2)   = snum_h_integral(kk,2)   + ww
            flow_h_integral(kk,1,2) = flow_h_integral(kk,1,2) + v1
            flow_h_integral(kk,2,2) = flow_h_integral(kk,2,2) + v2
            flow_h_integral(kk,3,2) = flow_h_integral(kk,3,2) + v3
            flow_h_integral(kk,4,2) = flow_h_integral(kk,4,2) + v4
        end if
!       Differential flow.
        ! pT cut
        if( c(2) >= afl(kk,2,1) .AND. c(2) <= afl(kk,2,2) )then
            ii = id(1)
            ! dv/dy
            if( ii >= 1 .AND. ii <= n_bin_hist )then
                dNy_h(ii,kk)    = dNy_h(ii,kk)    + ww
                dvdy_h(ii,1,kk) = dvdy_h(ii,1,kk) + v1
                dvdy_h(ii,2,kk) = dvdy_h(ii,2,kk) + v2
                dvdy_h(ii,3,kk) = dvdy_h(ii,3,kk) + v3
                dvdy_h(ii,4,kk) = dvdy_h(ii,4,kk) + v4
            end if
            ! dv/deta
            ii = id(3)
            if( ii >= 1 .AND. ii <= n_bin_hist )then
                dNeta_h(ii,kk)    = dNeta_h(ii,kk)    + ww
                dvdeta_h(ii,1,kk) = dvdeta_h(ii,1,kk) + v1
                dvdeta_h(ii,2,kk) = dvdeta_h(ii,2,kk) + v2
                dvdeta_h(ii,3,kk) = dvdeta_h(ii,3,kk) + v3
                dvdeta_h(ii,4,kk) = dvdeta_h(ii,4,kk) + v4
            end if
        end if
        ! y/eta cut
        if( c(1) >= afl(kk,1,1) .AND. c(1) <= afl(kk,1,2) )then
            ! dv/dpT
            ii = id(2)
            if( ii >= 1 .AND. ii <= n_bin_hist )then
                dNpT_h(ii,kk)    = dNpT_h(ii,kk)    + ww
                dvdpT_h(ii,1,kk) = dvdpT_h(ii,1,kk) + v1
                dvdpT_h(ii,2,kk) = dvdpT_h(ii,2,kk) + v2
                dvdpT_h(ii,3,kk) = dvdpT_h(ii,3,kk) + v3
                dvdpT_h(ii,4,kk) = dvdpT_h(ii,4,kk) + v4
            end if
        end if


        return
        end



!ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
        subroutine flow_particle( px, py, y, pT, eta, charge, kf, ww )
!!      Special subroutine for total, charged and pi+K+p.
!!      Calculates anisotropic flows of hadrons for hh, hA(Ah) & AB collisions.
!!      Uses the nominal cuts of 1-st setting in usu.dat.
        IMPLICIT DOUBLE PRECISION(A-H, O-Z)
        IMPLICIT INTEGER(I-N)
        common/sa1/kjp21,non1,bp,iii,neve,nout,nosc
        common/sa7/ispmax,isdmax,iflmax,ispkf(100),n_bin_hist,asd(10), &
         afl(100,10,2),i_y_or_eta
        common/ flow_part / snum_particle_integral(5,2),   &
                            flow_particle_integral(5,4,2), &
                            dNy_particle_f(100,5),      &
                            dNy_particle(100,5),        &
                            dNpT_particle_f(100,5),     &
                            dNpT_particle(100,5),       &
                            dNeta_particle_f(100,5),    &
                            dNeta_particle(100,5),      &
                            dvdy_particle_f(100,4,5),   &
                            dvdy_particle(100,4,5),     &
                            dvdpT_particle_f(100,4,5),  &
                            dvdpT_particle(100,4,5),    &
                            dvdeta_particle_f(100,4,5), &
                            dvdeta_particle(100,4,5)
        dimension c(10), id(10)


!       Excludes particles with too small/zero pT.
        if( pT <= 1D-15 ) return
        KFabs = ABS(kf)
        c(1)  = y
        if( i_y_or_eta == 1 ) c(1) = eta
        c(2)  = pt
!       .
!       .
!       .
!       Calculate the abscissa one by one.
!       y is located in which interval?
        id = 0
        mid_bin = n_bin_hist / 2
        ii = INT( ABS(y) / asd(1) + 1 )
        if( y >= 0. ) ii = ii + mid_bin
        if( y <  0. ) ii = mid_bin - ii + 1
        id(1) = ii
!       pT is located in which interval?
        id(2) = INT( pt / asd(2) + 1 )
!       eta is located in which interval?
        ii = INT( ABS(eta) / asd(3) + 1 )
        if( eta >= 0. ) ii = ii + mid_bin
        if( eta <  0. ) ii = mid_bin - ii + 1
        id(3) = ii

!       Flow components.
        v1 = px / pT
        v2 = ( px**2 - py**2 ) / pT**2
        v3 = ( px**3 - 3D0 * px * py**2 ) / pT**3
        v4 = ( px**4 - 6D0 * px**2 * py**2 + py**4 ) / pT**4

!       Flow in the full space (without cuts).

        do kk=1,3,1
!       All particles.
            ! if( kk == 1 ) continue
!       Charged particles.
            if( kk == 2 )then
                if( ABS( charge ) < 1D-5 ) cycle
!       pi+K+p particles.
            else if( kk == 3 )then
                if( KFabs /= 2212 .AND. KFabs /= 321 .AND. KFabs /= 211 ) cycle
            end if
!       Integral flow.
            snum_particle_integral(kk,1)   = snum_particle_integral(kk,1)   + ww
            flow_particle_integral(kk,1,1) = flow_particle_integral(kk,1,1) + v1
            flow_particle_integral(kk,2,1) = flow_particle_integral(kk,2,1) + v2
            flow_particle_integral(kk,3,1) = flow_particle_integral(kk,3,1) + v3
            flow_particle_integral(kk,4,1) = flow_particle_integral(kk,4,1) + v4
!       Differential flow.
            ! dv/dy
            ii = id(1)
            if( ii >= 1 .AND. ii <= n_bin_hist )then
                dNy_particle_f(ii,kk)    = dNy_particle_f(ii,kk)    + ww
                dvdy_particle_f(ii,1,kk) = dvdy_particle_f(ii,1,kk) + v1
                dvdy_particle_f(ii,2,kk) = dvdy_particle_f(ii,2,kk) + v2
                dvdy_particle_f(ii,3,kk) = dvdy_particle_f(ii,3,kk) + v3
                dvdy_particle_f(ii,4,kk) = dvdy_particle_f(ii,4,kk) + v4
            end if
            ! dv/dpT
            ii = id(2)
            if( ii >= 1 .AND. ii <= n_bin_hist )then
                dNpT_particle_f(ii,kk)    = dNpT_particle_f(ii,kk)    + ww
                dvdpT_particle_f(ii,1,kk) = dvdpT_particle_f(ii,1,kk) + v1
                dvdpT_particle_f(ii,2,kk) = dvdpT_particle_f(ii,2,kk) + v2
                dvdpT_particle_f(ii,3,kk) = dvdpT_particle_f(ii,3,kk) + v3
                dvdpT_particle_f(ii,4,kk) = dvdpT_particle_f(ii,4,kk) + v4
            end if
            ! dv/deta
            ii = id(3)
            if( ii >= 1 .AND. ii <= n_bin_hist )then
                dNeta_particle_f(ii,kk)    = dNeta_particle_f(ii,kk)    + ww
                dvdeta_particle_f(ii,1,kk) = dvdeta_particle_f(ii,1,kk) + v1
                dvdeta_particle_f(ii,2,kk) = dvdeta_particle_f(ii,2,kk) + v2
                dvdeta_particle_f(ii,3,kk) = dvdeta_particle_f(ii,3,kk) + v3
                dvdeta_particle_f(ii,4,kk) = dvdeta_particle_f(ii,4,kk) + v4
            end if
        end do

!       Flow in the partial space.

        do kk=1,3,1
!       All particles.
            ! if( kk == 1 ) continue
!       Charged particles.
            if( kk == 2 )then
                if( ABS( charge ) < 1D-5 ) cycle
!       pi+K+p particles.
            else if( kk == 3 )then
                if( KFabs /= 2212 .AND. KFabs /= 321 .AND. KFabs /= 211 ) cycle
            end if
!       Integral flow. pT & y/eta cuts. Note (1,*,*) here.
            if( c(2) >= afl(1,2,1) .AND. c(2) <= afl(1,2,2) .AND. &
                c(1) >= afl(1,1,1) .AND. c(1) <= afl(1,1,2) )then
                snum_particle_integral(kk,2)  =snum_particle_integral(kk,2)  +ww
                flow_particle_integral(kk,1,2)=flow_particle_integral(kk,1,2)+v1
                flow_particle_integral(kk,2,2)=flow_particle_integral(kk,2,2)+v2
                flow_particle_integral(kk,3,2)=flow_particle_integral(kk,3,2)+v3
                flow_particle_integral(kk,4,2)=flow_particle_integral(kk,4,2)+v4
            end if
!       Differential flow.
            ! pT cut
            if( c(2) >= afl(1,2,1) .AND. c(2) <= afl(1,2,2) )then
                ! dv/dy
                ii = id(1)
                if( ii >= 1 .AND. ii <= n_bin_hist )then
                    dNy_particle(ii,kk)    = dNy_particle(ii,kk)    + ww
                    dvdy_particle(ii,1,kk) = dvdy_particle(ii,1,kk) + v1
                    dvdy_particle(ii,2,kk) = dvdy_particle(ii,2,kk) + v2
                    dvdy_particle(ii,3,kk) = dvdy_particle(ii,3,kk) + v3
                    dvdy_particle(ii,4,kk) = dvdy_particle(ii,4,kk) + v4
                end if
                ! dv/deta
                ii = id(3)
                if( ii >= 1 .AND. ii <= n_bin_hist )then
                    dNeta_particle(ii,kk)    = dNeta_particle(ii,kk)    + ww
                    dvdeta_particle(ii,1,kk) = dvdeta_particle(ii,1,kk) + v1
                    dvdeta_particle(ii,2,kk) = dvdeta_particle(ii,2,kk) + v2
                    dvdeta_particle(ii,3,kk) = dvdeta_particle(ii,3,kk) + v3
                    dvdeta_particle(ii,4,kk) = dvdeta_particle(ii,4,kk) + v4
                end if
            end if
            ! y/eta cut
            if( c(1) >= afl(1,1,1) .AND. c(1) <= afl(1,1,2) )then
                ! dv/dpT
                ii = id(2)
                if( ii >= 1 .AND. ii <= n_bin_hist )then
                    dNpT_particle(ii,kk)    = dNpT_particle(ii,kk)    + ww
                    dvdpT_particle(ii,1,kk) = dvdpT_particle(ii,1,kk) + v1
                    dvdpT_particle(ii,2,kk) = dvdpT_particle(ii,2,kk) + v2
                    dvdpT_particle(ii,3,kk) = dvdpT_particle(ii,3,kk) + v3
                    dvdpT_particle(ii,4,kk) = dvdpT_particle(ii,4,kk) + v4
                end if
            end if
        end do


        return
        end



!ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
        subroutine flow_parton( px, py, y, pT, eta, kf, kk, ww )
!!      Calculates anisotropic flows of hadrons for hh, hA(Ah) & AB collisions.
        IMPLICIT DOUBLE PRECISION(A-H, O-Z)
        IMPLICIT INTEGER(I-N)
        common/sa1/kjp21,non1,bp,iii,neve,nout,nosc
        common/sa7/ispmax,isdmax,iflmax,ispkf(100),n_bin_hist,asd(10), &
         afl(100,10,2),i_y_or_eta
        common/ flow_p / snum_p_integral(20,2),   &
                         flow_p_integral(20,4,2), &
                         dNy_p_f(100,20),      &
                         dNy_p(100,20),        &
                         dNpT_p_f(100,20),     &
                         dNpT_p(100,20),       &
                         dNeta_p_f(100,20),    &
                         dNeta_p(100,20),      &
                         dvdy_p_f(100,4,20),   &
                         dvdy_p(100,4,20),     &
                         dvdpT_p_f(100,4,20),  &
                         dvdpT_p(100,4,20),    &
                         dvdeta_p_f(100,4,20), &
                         dvdeta_p(100,4,20)
        dimension c(10), id(10)


!       Excludes particles with too small/zero pT.
        if( pT <= 1D-15 ) return
        c(1) = y
        if( i_y_or_eta == 1 ) c(1) = eta
        c(2) = pt
!       .
!       .
!       .
!       Calculate the abscissa one by one.
!       y is located in which interval?
        id = 0
        mid_bin = n_bin_hist / 2
        ii = INT( ABS(y) / asd(1) + 1 )
        if( y >= 0. ) ii = ii + mid_bin
        if( y <  0. ) ii = mid_bin - ii + 1
        id(1) = ii
!       pT is located in which interval?
        id(2) = INT( pt / asd(2) + 1 )
!       eta is located in which interval?
        ii = INT( ABS(eta) / asd(3) + 1 )
        if( eta >= 0. ) ii = ii + mid_bin
        if( eta <  0. ) ii = mid_bin - ii + 1
        id(3) = ii

!       Flow components.
        v1 = px / pT
        v2 = ( px**2 - py**2 ) / pT**2
        v3 = ( px**3 - 3D0 * px * py**2 ) / pT**3
        v4 = ( px**4 - 6D0 * px**2 * py**2 + py**4 ) / pT**4

!       Flow in the full space (without cuts).

!       Integral flow.
        snum_p_integral(kk,1)   = snum_p_integral(kk,1)   + ww
        flow_p_integral(kk,1,1) = flow_p_integral(kk,1,1) + v1
        flow_p_integral(kk,2,1) = flow_p_integral(kk,2,1) + v2
        flow_p_integral(kk,3,1) = flow_p_integral(kk,3,1) + v3
        flow_p_integral(kk,4,1) = flow_p_integral(kk,4,1) + v4
        ! u+d+s
        if( ABS(kf) >= 1 .AND. ABS(kf) <= 3 )then
            snum_p_integral(2,1)   = snum_p_integral(2,1)   + ww
            flow_p_integral(2,1,1) = flow_p_integral(2,1,1) + v1
            flow_p_integral(2,2,1) = flow_p_integral(2,2,1) + v2
            flow_p_integral(2,3,1) = flow_p_integral(2,3,1) + v3
            flow_p_integral(2,4,1) = flow_p_integral(2,4,1) + v4
        end if
!       Differential flow.
        ! dv/dy
        ii = id(1)
        if( ii >= 1 .AND. ii <= n_bin_hist )then
            dNy_p_f(ii,kk)    = dNy_p_f(ii,kk)    + ww
            dvdy_p_f(ii,1,kk) = dvdy_p_f(ii,1,kk) + v1
            dvdy_p_f(ii,2,kk) = dvdy_p_f(ii,2,kk) + v2
            dvdy_p_f(ii,3,kk) = dvdy_p_f(ii,3,kk) + v3
            dvdy_p_f(ii,4,kk) = dvdy_p_f(ii,4,kk) + v4
            ! u+d+s
            if( ABS(kf) >= 1 .AND. ABS(kf) <= 3 )then
                dNy_p_f(ii,2)    = dNy_p_f(ii,2)    + ww
                dvdy_p_f(ii,1,2) = dvdy_p_f(ii,1,2) + v1
                dvdy_p_f(ii,2,2) = dvdy_p_f(ii,2,2) + v2
                dvdy_p_f(ii,3,2) = dvdy_p_f(ii,3,2) + v3
                dvdy_p_f(ii,4,2) = dvdy_p_f(ii,4,2) + v4
            end if
        end if
        ! dv/dpT
        ii = id(2)
        if( ii >= 1 .AND. ii <= n_bin_hist )then
            dNpT_p_f(ii,kk)    = dNpT_p_f(ii,kk)    + ww
            dvdpT_p_f(ii,1,kk) = dvdpT_p_f(ii,1,kk) + v1
            dvdpT_p_f(ii,2,kk) = dvdpT_p_f(ii,2,kk) + v2
            dvdpT_p_f(ii,3,kk) = dvdpT_p_f(ii,3,kk) + v3
            dvdpT_p_f(ii,4,kk) = dvdpT_p_f(ii,4,kk) + v4
            ! u+d+s
            if( ABS(kf) >= 1 .AND. ABS(kf) <= 3 )then
                dNpT_p_f(ii,2)    = dNpT_p_f(ii,2)    + ww
                dvdpT_p_f(ii,1,2) = dvdpT_p_f(ii,1,2) + v1
                dvdpT_p_f(ii,2,2) = dvdpT_p_f(ii,2,2) + v2
                dvdpT_p_f(ii,3,2) = dvdpT_p_f(ii,3,2) + v3
                dvdpT_p_f(ii,4,2) = dvdpT_p_f(ii,4,2) + v4
            end if
        end if
        ! dv/deta
        ii = id(3)
        if( ii >= 1 .AND. ii <= n_bin_hist )then
            dNeta_p_f(ii,kk)    = dNeta_p_f(ii,kk)    + ww
            dvdeta_p_f(ii,1,kk) = dvdeta_p_f(ii,1,kk) + v1
            dvdeta_p_f(ii,2,kk) = dvdeta_p_f(ii,2,kk) + v2
            dvdeta_p_f(ii,3,kk) = dvdeta_p_f(ii,3,kk) + v3
            dvdeta_p_f(ii,4,kk) = dvdeta_p_f(ii,4,kk) + v4
            ! u+d+s
            if( ABS(kf) >= 1 .AND. ABS(kf) <= 3 )then
                dNeta_p_f(ii,2)    = dNeta_p_f(ii,2)    + ww
                dvdeta_p_f(ii,1,2) = dvdeta_p_f(ii,1,2) + v1
                dvdeta_p_f(ii,2,2) = dvdeta_p_f(ii,2,2) + v2
                dvdeta_p_f(ii,3,2) = dvdeta_p_f(ii,3,2) + v3
                dvdeta_p_f(ii,4,2) = dvdeta_p_f(ii,4,2) + v4
            end if
        end if

!       Flow in partial space.

!       Differential flow.
!       pT & y/eta cuts.
        if( c(2) >= afl(kk,2,1) .AND. c(2) <= afl(kk,2,2) .AND. &
            c(1) >= afl(kk,1,1) .AND. c(1) <= afl(kk,1,2) )then
!       Integral flow.
            snum_p_integral(kk,2)   = snum_p_integral(kk,2)   + ww
            flow_p_integral(kk,1,2) = flow_p_integral(kk,1,2) + v1
            flow_p_integral(kk,2,2) = flow_p_integral(kk,2,2) + v2
            flow_p_integral(kk,3,2) = flow_p_integral(kk,3,2) + v3
            flow_p_integral(kk,4,2) = flow_p_integral(kk,4,2) + v4
            ! u+d+s
            if( ABS(kf) >= 1 .AND. ABS(kf) <= 3 )then
                snum_p_integral(2,2)   = snum_p_integral(2,2)   + ww
                flow_p_integral(2,1,2) = flow_p_integral(2,1,2) + v1
                flow_p_integral(2,2,2) = flow_p_integral(2,2,2) + v2
                flow_p_integral(2,3,2) = flow_p_integral(2,3,2) + v3
                flow_p_integral(2,4,2) = flow_p_integral(2,4,2) + v4
            end if
        end if
        ! pT cut
        if( c(2) >= afl(kk,2,1) .AND. c(2) <= afl(kk,2,2) )then
            ii = id(1)
            ! dv/dy
            if( ii >= 1 .AND. ii <= n_bin_hist )then
                dNy_p(ii,kk)    = dNy_p(ii,kk)    + ww
                dvdy_p(ii,1,kk) = dvdy_p(ii,1,kk) + v1
                dvdy_p(ii,2,kk) = dvdy_p(ii,2,kk) + v2
                dvdy_p(ii,3,kk) = dvdy_p(ii,3,kk) + v3
                dvdy_p(ii,4,kk) = dvdy_p(ii,4,kk) + v4
                ! u+d+s
                if( ABS(kf) >= 1 .AND. ABS(kf) <= 3 )then
                    dNy_p(ii,2)    = dNy_p(ii,2)    + ww
                    dvdy_p(ii,1,2) = dvdy_p(ii,1,2) + v1
                    dvdy_p(ii,2,2) = dvdy_p(ii,2,2) + v2
                    dvdy_p(ii,3,2) = dvdy_p(ii,3,2) + v3
                    dvdy_p(ii,4,2) = dvdy_p(ii,4,2) + v4
                end if
            end if
            ! dv/deta
            ii = id(3)
            if( ii >= 1 .AND. ii <= n_bin_hist )then
                dNeta_p(ii,kk)    = dNeta_p(ii,kk)    + ww
                dvdeta_p(ii,1,kk) = dvdeta_p(ii,1,kk) + v1
                dvdeta_p(ii,2,kk) = dvdeta_p(ii,2,kk) + v2
                dvdeta_p(ii,3,kk) = dvdeta_p(ii,3,kk) + v3
                dvdeta_p(ii,4,kk) = dvdeta_p(ii,4,kk) + v4
                ! u+d+s
                if( ABS(kf) >= 1 .AND. ABS(kf) <= 3 )then
                    dNeta_p(ii,2)    = dNeta_p(ii,2)    + ww
                    dvdeta_p(ii,1,2) = dvdeta_p(ii,1,2) + v1
                    dvdeta_p(ii,2,2) = dvdeta_p(ii,2,2) + v2
                    dvdeta_p(ii,3,2) = dvdeta_p(ii,3,2) + v3
                    dvdeta_p(ii,4,2) = dvdeta_p(ii,4,2) + v4
                end if
            end if
        end if
        ! y/eta cut
        if( c(1) >= afl(kk,1,1) .AND. c(1) <= afl(kk,1,2) )then
            ! dv/dpT
            ii = id(2)
            if( ii >= 1 .AND. ii <= n_bin_hist )then
                dNpT_p(ii,kk)    = dNpT_p(ii,kk)    + ww
                dvdpT_p(ii,1,kk) = dvdpT_p(ii,1,kk) + v1
                dvdpT_p(ii,2,kk) = dvdpT_p(ii,2,kk) + v2
                dvdpT_p(ii,3,kk) = dvdpT_p(ii,3,kk) + v3
                dvdpT_p(ii,4,kk) = dvdpT_p(ii,4,kk) + v4
            ! u+d+s
                if( ABS(kf) >= 1 .AND. ABS(kf) <= 3 )then
                    dNpT_p(ii,2)    = dNpT_p(ii,2)    + ww
                    dvdpT_p(ii,1,2) = dvdpT_p(ii,1,2) + v1
                    dvdpT_p(ii,2,2) = dvdpT_p(ii,2,2) + v2
                    dvdpT_p(ii,3,2) = dvdpT_p(ii,3,2) + v3
                    dvdpT_p(ii,4,2) = dvdpT_p(ii,4,2) + v4
                end if
            end if
        end if


        return
        end



!ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
        subroutine output_header
!!      Ptints the header of "rms.out".
        IMPLICIT DOUBLE PRECISION(A-H, O-Z)
        IMPLICIT INTEGER(I-N)
        LOGICAL IS_PYTHIA8,IS_NUCLEUS
        PARAMETER (KSZJ=80000)
        COMMON/PYDAT1/MSTU(200),PARU(200),MSTJ(200),PARJ(200)
        COMMON/PYDAT2/KCHG(500,4),PMAS(500,4),PARF(2000),VCKM(4,4)
        COMMON/PYDAT3/MDCY(500,3),MDME(8000,2),BRAT(8000),KFDP(8000,5)
        COMMON/PYJETS/N,NPAD,K(KSZJ,5),P(KSZJ,5),V(KSZJ,5)
        COMMON/PYPARS/MSTP(200),PARP(200),MSTI(200),PARI(200)
        COMMON/PYSUBS/MSEL,MSELPD,MSUB(500),KFIN(2,-40:40),CKIN(200)
        COMMON/PYDATR/MRPY(6),RRPY(100)
        COMMON/PYINT1/MINT(400),VINT(400)
        common/sa1/kjp21,non1,bp,iii,neve,nout,nosc
        common/sa10/csnn,cspin,cskn,cspipi,cspsn,cspsm,rcsit,ifram, &
         iabsb,iabsm,i_sigma_AQM,ajpsi,csspn,csspm,csen
        common/sa12/ppsa(5),nchan,nsjp,sjp,ttaup,taujp
        common/sa16/x_ratio,decpro,dni(10),dpi(10),edi(10),bmin,bmax, &
         bar(10),abar(10),barf(10),abarf(10),emin(10),eminf(10), &
         eplu(10),epluf(10),nmax
        common/sa18/i_deex,n_deex_step,i_pT_coal,i_pT_endpoint,a_FF,aPS_c,aPS_b
        common/sa24/adj1(40),nnstop,non24,zstop
        common/sa27/itime,kjp22,gtime,astr,akapa(6),parj1,parj2,parj3, &
         parj21,parj4,adiv,gpmax,nnc
        common/sa29/i_color_reconnection,NCR,parp2
        common/sa30/vneump,vneumt,mstptj
        common/sa34/itorw,iikk,cp0,cr0,kkii
        common/syspar/ipden,itden,suppm,suptm,suppc,suptc,r0p,r0t, &
         nap,nat,nzp,nzt,pio
        COMMON/SA1_PY8/ i_mode, i_tune, KF_woDecay(100), &
               KF_proj, KF_targ, win, energy_B, psno, b_min, b_max
!       MRPY(1) is the seed of PYTHIA random number generator (D=20240116).
!       For the intrinsic subroutine DATE_AND_TIME calling.
        dimension n_current_date_and_time(8)
        character*4 c_date_and_time(8)
        CHARACTER*100 NAME_MODE(9), NAME_TUNE, &
                     NAME_HAD, NAME_CR, NAME_SUB, NAME_SHAD, &
                     SUFFIX
                    !  PREFIX, INFIX, SUFFIX
        DATA NAME_MODE / "A-framework                   ", &
                         "B-framework PYTHIA 6          ", &
                         "C-framework PYTHIA 6          ", &
                         "D-framework PYTHIA 6          ", &
                         "B-framework PYTHIA 8          ", &
                         "C-framework PYTHIA 8          ", &
                         "i_mode 7                      ", &
                         "B-framework PYTHIA8/Angantyr  ", &
                         "C-framework PYTHIA8/Angantyr  "  /
        CHARACTER CHCDE(34)*12, CHNAME*16, EMPTY*16
        DIMENSION KCDE(34)
        DATA CHCDE/ &
        "2H          ","2Hbar       ","4He         ","4Hebar      ", &
        "6Li         ","6Libar      ","9Be         ","9Bebar      ", &
        "12C         ","12Cbar      ","14N         ","14Nbar      ", &
        "16O         ","16Obar      ","27Al        ","27Albar     ", &
        "40Ar        ","40Arbar     ","56Fe        ","56Febar     ", &
        "63Cu        ","63Cubar     ","84Kr        ","84Krbar     ", &
        "107Ag       ","107Agbar    ","129Xe       ","129Xebar    ", &
        "197Au       ","197Aubar    ","208Pb       ","208Pbbar    ", &
        "myIon       ","null        "/
        DATA KCDE/1000010020, -1000010020, 1000020040, -1000020040, &
                  1000030060, -1000030060, 1000040090, -1000040090, &
                  1000060120, -1000060120, 1000070140, -1000070140, &
                  1000080160, -1000080160, 1000130270, -1000130270, &
                  1000180400, -1000180400, 1000260560, -1000260560, &
                  1000290630, -1000290630, 1000360840, -1000360840, &
                  1000471070, -1000471070, 1000541290, -1000541290, &
                  1000791970, -1000791970, 1000822080, -1000822080, &
                  1009999990, 0/
        CHARACTER*100 NAME_PROJ, NAME_TARG, NAME_FRAME
        CHARACTER*100 C_NAP,C_NZP,C_NAT,C_NZT, C_WIN,C_EB, C_BMIN,C_BMAX
        CHARACTER(5) cPACIAE_VERSION, cPYTHIA6_VERSION, cPYTHIA8_VERSION
        DATA cPACIAE_VERSION / "4.003" /


!       The hadronization model.
        i_had_model = INT( adj1(12) )

!       User output
!       Header.
        write(10,*) "#!**************************************" // &
                    "*************************************!#"
        write(10,*) "#!*********************|" // &
                    "    PACIAE  Analysis  Output    " // &
                    "|********************!#"
        write(10,*) "#!**************************************" // &
                    "*************************************!#"

!       Displays the current real date and time.
        call DATE_AND_TIME(VALUES=n_current_date_and_time)
        do i1=1,8
        write(c_date_and_time(i1),"(I4)") n_current_date_and_time(i1)
        enddo
        write(10,*)
        write(10,*) "#! Now is   " //TRIM(ADJUSTL( c_date_and_time(5) )) &
                          //   ':' //TRIM(ADJUSTL( c_date_and_time(6) )) &
                          //   ':' //TRIM(ADJUSTL( c_date_and_time(7) )) &
                          // "   " //TRIM(ADJUSTL( c_date_and_time(3) )) &
                          //   '/' //TRIM(ADJUSTL( c_date_and_time(2) )) &
                          //   '/' //TRIM(ADJUSTL( c_date_and_time(1) ))


        KF_proj_abs = ABS( KF_proj )
        KF_targ_abs = ABS( KF_targ )

!       Displays the current version.
        version_pythia6 = MSTP(181)*1D0 + MSTP(182)*1D-3
        version_pythia8 = VINT(396)
        write( cPYTHIA6_VERSION, "(F5.3)" ) version_pythia6
        write( cPYTHIA8_VERSION, "(F5.3)" ) version_pythia8
        write(10,*) "#! Current version: " &
                 // "PACIAE "    // cPACIAE_VERSION &
                 // "  +  PYTHIA " // cPYTHIA6_VERSION &
                 // "  +  PYTHIA " // cPYTHIA8_VERSION

!       Displays the seed of random number generator.
        i_seed_out = 20240116
        if( INT( adj1(26) ) /= 0 ) i_seed_out = MRPY(1)
        write(10,*) "#! Seed (PACIAE default=20240116) =", i_seed_out

!       Displays the collision system.
        write( C_NAP, "(I5)" ) nap
        write( C_NZP, "(I5)" ) nzp
        write( C_NAT, "(I5)" ) nat
        write( C_NZT, "(I5)" ) nzt
!       Gets names of the projectile and target.
        NAME_PROJ = '?'
        NAME_TARG = '?'
        EMPTY = ' '
        ! Nucleus.
        if( IS_NUCLEUS(KF_proj) )then
            NAME_PROJ = 'A'
            do i=1,34,1
                if( KF_proj == KCDE(i) ) NAME_PROJ = CHCDE(i)
            end do
            NAME_PROJ = TRIM(ADJUSTL( NAME_PROJ )) // "( " &
                     // TRIM(ADJUSTL( C_NAP ))     // ", " &
                     // TRIM(ADJUSTL( C_NZP ))     // " )"
        ! Non-nucleus.
        else
            call PYNAME( KF_proj, CHNAME )
            if( CHNAME /= EMPTY ) NAME_PROJ = CHNAME
        end if
        ! Nucleus.
        if( IS_NUCLEUS(KF_targ) )then
            NAME_TARG = 'B'
            do i=1,34,1
                if( KF_targ == KCDE(i) ) NAME_TARG = CHCDE(i)
            end do
            NAME_TARG = TRIM(ADJUSTL( NAME_TARG )) // "( " &
                     // TRIM(ADJUSTL( C_NAT ))     // ", " &
                     // TRIM(ADJUSTL( C_NZT ))     // " )"
        ! Non-nucleus.
        else
            call PYNAME( KF_targ, CHNAME )
            if( CHNAME /= EMPTY ) NAME_TARG = CHNAME
        end if
!       Gets characters of energy and b parameters.
        write( C_WIN, "(F10.3)" ) win
        write( C_EB,  "(F10.3)" ) energy_B
        write( C_BMIN, "(F7.3)" ) bmin
        write( C_BMAX, "(F7.3)" ) bmax
        NAME_FRAME = "CM energy"
        if( ifram == 0 ) NAME_FRAME = "FIXT +pz"
        if( ifram == 2 ) NAME_FRAME = "LAB energy"
        SUFFIX = ""
        if( IS_NUCLEUS(KF_proj) .OR. IS_NUCLEUS(KF_targ) ) &
            SUFFIX = " within " // TRIM(ADJUSTL( C_BMIN )) &
                                // " <= b <= " &
                                // TRIM(ADJUSTL( C_BMAX )) // " fm"

        if( ifram == 0 .OR. ifram == 1 )then
            write(10,*) "#! Collision system         : " &
                        // TRIM(ADJUSTL( NAME_PROJ ))  // " + "    &
                        // TRIM(ADJUSTL( NAME_TARG ))  // " at a " &
                        // TRIM(ADJUSTL( NAME_FRAME )) // " of "   &
                        // TRIM(ADJUSTL( C_WIN ))      // " GeV "  &
                        // TRIM(ADJUSTL( SUFFIX ))
        else
            write(10,*) "#! Collision system         : " &
                        // TRIM(ADJUSTL( NAME_PROJ ))   // " + "    &
                        // TRIM(ADJUSTL( NAME_TARG ))   // " at a " &
                        // TRIM(ADJUSTL( NAME_FRAME ))  // " of "   &
                        // TRIM(ADJUSTL( C_WIN ))       // " + "    &
                        // TRIM(ADJUSTL( C_EB ))        // " GeV "  &
                        // TRIM(ADJUSTL( SUFFIX ))
        end if

!       Displays the simulation mode and tune used.
        NAME_TUNE  = ""
        write( NAME_TUNE, * ) ABS(i_tune)
        if( i_tune == 0 )then
            if( i_mode == 1 )then
                NAME_TUNE = "null in this mode"
            else if( .NOT.IS_PYTHIA8(i_mode) )then
                NAME_TUNE= "Perugia 2011 Tune as the basis"
            else if( IS_PYTHIA8(i_mode) )then
                NAME_TUNE = "Monash 2013 Tune as the basis"
            end if
        end if
        write(10,*) "#! Simulation mode          : " &
                    // TRIM( ADJUSTL(NAME_MODE(i_mode)) )
        write(10,*) "#! Tune                     : " &
                    // TRIM( ADJUSTL(NAME_TUNE) )

!       Displays the subprocess status.
        NAME_SUB  = ""
        if( nchan >= 0 )then
            select case (nchan)
            case(0)
                NAME_SUB = "inelastic (INEL)"
            case(1)
                NAME_SUB = "non-single-diffractive (NSD)"
            case(2)
                NAME_SUB = "Drell-Yan"
            case(3)
                NAME_SUB = "J/psi production (color singlet)"
            case(4)
                NAME_SUB = "heavy-flavor production"
            case(5)
                NAME_SUB = "direct photon"
            case(6)
                NAME_SUB = "soft QCD"
            case(7)
                NAME_SUB = "W+/- production"
            case(8)
                NAME_SUB = "hard QCD"
            case(9)
                NAME_SUB = "Z0 production"
            case(10)
                NAME_SUB = "inelastic, non-diffractive (Minimum-Bias)"
            case default
                NAME_SUB = "hard QCD"
            end select
        else if( nchan < 0 )then
            if( nchan == -61)then
                NAME_SUB = "NRQCD charmonium production"
            else if( nchan == -62)then
                NAME_SUB = "NRQCD bottomonium production"
            else if( nchan == -63)then
                NAME_SUB = "NRQCD onia production (charm- and bottom-)"
            else
                write(SUFFIX,*) -nchan
                NAME_SUB = "PYTHIA6 MSEL = " // TRIM( ADJUSTL( SUFFIX ))
            end if
        else
            if( .NOT.IS_PYTHIA8(i_mode) )then
                NAME_SUB = "user-defined subprocess in the " &
                         // """pythia6_extra.cfg"" file"
            else if( IS_PYTHIA8(i_mode) )then
                NAME_SUB = "user-defined subprocess in the " &
                        // """pythia8_extra.cfg"" file"
            end if
        end if
        if( KF_proj_abs == 11 .AND. KF_targ_abs == 11 .AND. &
            KF_proj*KF_targ < 0 ) &
            NAME_SUB = "e+e- -> gamma*/Z0 -> qqbar"
        if( i_mode == 1 ) NAME_SUB = "null in this mode"
        write(10,*) "#! Subprocess               : " &
                    // TRIM( ADJUSTL( NAME_SUB ) )

!       Displays the nuclear shadowing status.
        NAME_SHAD = ""
        if( ipden /= 1 .AND. itden /= 1 )then
            NAME_SHAD = "null in this collision system"
        else
            if( INT(adj1(5))  ==  0 )then
                NAME_SHAD = "off"
            else
                if( .NOT.IS_PYTHIA8(i_mode) )then
                    NAME_SHAD = "Wang's nuclear shadowing"
                    if( INT(adj1(5)) == 2 ) &
                    NAME_SHAD = "EPS09 nPDF"
                else if( IS_PYTHIA8(i_mode) )then
                    if( INT(adj1(5)) == -1 )then
                        NAME_SHAD = "only Isospin effect"
                    else if( INT(adj1(5)) == 1 )then
                        NAME_SHAD = "EPS09 LO nPDF"
                    else if( INT(adj1(5)) == 2 )then
                        NAME_SHAD = "EPS09 NLO nPDF"
                    else if( INT(adj1(5)) == 3 )then
                        NAME_SHAD = "EPS16 NLO nPDF"
                    else
                        NAME_SHAD = "error"
                    end if
                end if
            end if
        end if
        if( i_mode == 1 ) NAME_SHAD = "null in this mode"
        write(10,*) "#! Nuclear shadowing / nPDF : " // &
                    TRIM( ADJUSTL(NAME_SHAD) )

!       Displays the color reconnection status.
        NAME_CR  = ""
        if( i_mode == 1 )then
            NAME_CR = "null in this mode"
        else if( .NOT.IS_PYTHIA8(i_mode) )then
            select case( MSTP(95) )
            case(0)
                NAME_CR = "off"
            case(1)
                NAME_CR = "old cut-and-paste style CR"
            case(2)
                NAME_CR = "Annealing Type I(no gg loops); " // &
                          "hadron-hadron only"
            case(3)
                NAME_CR = "Annealing Type I(no gg loops); " // &
                          "all beams"
            case(4)
                NAME_CR = "Annealing Type II(no gg loops); " // &
                          "hadron-hadron only"
            case(5)
                NAME_CR = "Annealing Type II(no gg loops); " // &
                          "all beams"
            case(6)
                NAME_CR = "Annealing Type Seattle; " // &
                          "hadron-hadron only"
            case(7)
                NAME_CR = "Annealing Type Seattle; " // &
                          "all beams"
            case(8)
                NAME_CR = "Annealing Type Paquis; " // &
                          "hadron-hadron only"
            case(9)
                NAME_CR = "Annealing Type Paquis; " // &
                          "all beams"
            ! case(10)
            !     NAME_CR = ""
            case(11)
                NAME_CR = "Soft Color Interaction (SCI model)"
            case(12)
                NAME_CR = "Soft Color Interaction (SCI model) " // &
                          "without diffraction (no inter-remnant CR)"
            case(13)
                NAME_CR = "Generalized Area Law (GAL model)"
            case(14)
                NAME_CR = "Generalized Area Law (GAL model) " // &
                          "without diffraction (no inter-remnant CR)"
            case default
                NAME_CR = "unknown CR mode"
            end select
        else if( IS_PYTHIA8(i_mode) )then
            select case( MSTP(95) )
            case(-1)
                NAME_CR = "off"
            case(0)
                NAME_CR = "default PYTHIA 8 MPI-based scheme (MPI-CR)"
            case(1)
                NAME_CR = "QCD based scheme (QCD-CR, QCD-CR-BLC " // &
                          "Beyond Leading Color )"
            case(2)
                NAME_CR = "new gluon-move model"
            case(3)
                NAME_CR = "SK I e+e- CR model"
            case(4)
                NAME_CR = "SK II e+e- CR model"
            case default
                NAME_CR = "unknown CR mode"
            end select
        end if
        write(10,*) "#! Color reconnection       : " // &
                    TRIM(ADJUSTL( NAME_CR ))

!       Displays the hadronization status.
        NAME_HAD  = ""
        SUFFIX    = ""
        if( i_mode == 1 )then
            NAME_HAD = "null in this mode"
            SUFFIX   = ""
        ! else if( i_had_model /= 0 )then
        else if( i_had_model == 1 )then
            NAME_HAD = "traversal coalescence"
            SUFFIX = "(g-splitting & q-deexcitation after " // &
                     "partonic rescattering)"
            select case( kjp22 )
            case(1)
                SUFFIX   = "(mode 1, g-splitting & q-deexcitation " // &
                           "after partonic rescattering)"
            case(2)
                SUFFIX   = "(mode 2, g-splitting & q-deexcitation " // &
                           "before partonic rescattering)"
            case(3)
                SUFFIX   = "(mode 3, q-deexcitation " // &
                           "after partonic rescattering)"
            case(4)
                SUFFIX   = "(mode 4, q-deexcitation " // &
                           "before partonic rescattering)"
    !         case(5)   ! Same as 1.
    !             SUFFIX = "(mode 1, g-splitting & q-deexcitation " // &
    !  &                   "after partonic rescattering)"
            case(6)
                NAME_HAD = "random coalescence"
                SUFFIX   = "(mode 6, g-splitting & q-deexcitation " // &
                           "after partonic rescattering)"
            case(7)
                NAME_HAD = "random coalescence"
                SUFFIX   = "(mode 7, g-splitting & q-deexcitation " // &
                           "before partonic rescattering)"
            case(8)
                NAME_HAD = "random coalescence"
                SUFFIX   = "(mode 8, q-deexcitation " // &
                           "after partonic rescattering)"
            case(9)
                NAME_HAD = "random coalescence"
                SUFFIX   = "(mode 9, q-deexcitation " // &
                           "before partonic rescattering)"
            end select
            if( i_deex > 99 ) SUFFIX = "mode debug before " &
                                     // "partonic rescattering"
        else if( ( i_had_model == 0 .OR. i_had_model == 3 ) .AND. &
                 kjp22 >= 1 .AND.kjp22 <= 5 )then
            NAME_HAD = "string fragmentation"
            if( i_had_model == 3 ) NAME_HAD = "string fragmentation"// &
                " with g-splitting & q-deexcitation before partonic " // &
                " rescattering"
            select case( kjp22 )
            case(1)
                SUFFIX = "(mode 1, single-string tension fluctuation)"
            case(2)
                SUFFIX = "(mode 2, multiple-string interaction)"
            case(3)
                SUFFIX = "(mode 3, single-string tension fluctuation" // &
                         " + multiple-string interaction)"
            case(4)
                SUFFIX = "(mode 4, all strings at once with default " // &
                         "tension)"
            case(5)
                SUFFIX = "(mode 5, NN pair by pair with default " // &
                         "tension)"
            end select
        else if( i_had_model == 0 .AND. IS_PYTHIA8(i_mode) )then
            NAME_HAD = "string (rope) fragmentation"
            select case( kjp22 )
            case(6)
                SUFFIX = "(mode 6, flavor rope)"
            case(7)
                SUFFIX = "(mode 7, string shoving)"
            case(8)
                SUFFIX = "(mode 8, flavor rope + string shoving)"
            case(9)
                NAME_HAD = "(thermodynamical) string fragmentation"
                SUFFIX = "(mode 9, thermal model)"
            end select
        else if( i_had_model == 0 )then
            NAME_HAD = "string fragmentation"
            SUFFIX = "(mode 5, NN pair by pair with default " // &
                         "tension)"
        end if
        write(10,*) "#! Hadronization            : " // &
                    TRIM( ADJUSTL( NAME_HAD ) ) // " " // &
                    TRIM( ADJUSTL( SUFFIX ) )

!       Displays the partonic and hadronic rescattering status.
        if( mstptj == 1 )then
            write(10,*) "#! Partonic rescattering    : null in this mode"
        else if( adj1(1) > 0D0 )then
            write(10,*) "#! Partonic rescattering    : on"
        else
            write(10,*) "#! Partonic rescattering    : off"
        end if
        if( kjp21 == 1 )then
            write(10,*) "#! Hadronic rescattering    : on"
        else
            write(10,*) "#! Hadronic rescattering    : off"
        end if
        ! Empty line.
        write(10,*)


        return
        end



!ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
        subroutine output_hadron_distribution
!!      Outpouts seven distributions of hadrons.
        IMPLICIT DOUBLE PRECISION(A-H, O-Z)
        IMPLICIT INTEGER(I-N)
        PARAMETER (KSZJ=80000)
        COMMON/PYJETS/N,NPAD,K(KSZJ,5),P(KSZJ,5),V(KSZJ,5)
        common/sa1/kjp21,non1,bp,iii,neve,nout,nosc
        common/sa7/ispmax,isdmax,iflmax,ispkf(100),n_bin_hist,asd(10), &
         afl(100,10,2),i_y_or_eta
        common/anly1_sum1/ san(100,10,100),  sbn(100,2), &
                          sanf(100,10,100), sbnf(100,2), &
                           sao(100,10,100),  sbo(100,2), &
                          saof(100,10,100), sbof(100,2)
!       The following statements are for user-output after event analyzing.
        dimension xcoor(100,10),xcoor_low(10)
        character*16 name_KF(100)
        character*7 cut_off(2,2)
        character*4 id_abscissa(10)
        data id_abscissa /  "y",   "pT", "eta", "mT", "mult", &
                           "pT", "mult",    "",   "",    ""  /
        character*50 id_distr(10)
        data id_distr / "dN/dy VS. y", "(1/pT)dN/dpT VS. pT",            &
                        "dN/deta VS. eta", "(1/mT)dN/dmT VS. mT",        &
                      "event-wise multiplicity: dNevent/dmult VS. mult", &
                        "dN/dpT VS. pT",                                 &
                      "mean pT <pT> VS. mult (event-wise multiplicity)", &
                      "", "", "" /
        common/anly3/ xcoor, xcoor_low, cut_off, id_abscissa, id_distr
        common/anly4/ distr(100,10,5), dMult(5,2), distr_f(100,10,5), &
         dMult_f(5,2), san_distr(100,10,5), sbn_mult(5,2), &
         san_distr_f(100,10,5), sbn_mult_f(5,2), sao_distr(100,10,5), &
         sbo_mult(5,2), sao_distr_f(100,10,5), sbo_mult_f(5,2)
        common/ flow_h / snum_h_integral(100,2),   &
                         flow_h_integral(100,4,2), &
                         dNy_h_f(100,100),      &
                         dNy_h(100,100),        &
                         dNpT_h_f(100,100),     &
                         dNpT_h(100,100),       &
                         dNeta_h_f(100,100),    &
                         dNeta_h(100,100),      &
                         dvdy_h_f(100,4,100),   &
                         dvdy_h(100,4,100),     &
                         dvdpT_h_f(100,4,100),  &
                         dvdpT_h(100,4,100),    &
                         dvdeta_h_f(100,4,100), &
                         dvdeta_h(100,4,100)
        common/ flow_part / snum_particle_integral(5,2),   &
                            flow_particle_integral(5,4,2), &
                            dNy_particle_f(100,5),      &
                            dNy_particle(100,5),        &
                            dNpT_particle_f(100,5),     &
                            dNpT_particle(100,5),       &
                            dNeta_particle_f(100,5),    &
                            dNeta_particle(100,5),      &
                            dvdy_particle_f(100,4,5),   &
                            dvdy_particle(100,4,5),     &
                            dvdpT_particle_f(100,4,5),  &
                            dvdpT_particle(100,4,5),    &
                            dvdeta_particle_f(100,4,5), &
                            dvdeta_particle(100,4,5)
        character*5 cyeta


!-------------------------------------------------------------------------------
        if(iii == nout .OR. iii == neve)then
!           Calculates the abscissa of the distributions.
            do m2=1,isdmax,1
                xcoor_low(m2) = -0.5*asd(m2)
                if(m2 == 1 .OR. m2 == 3) &
                    xcoor_low(m2) = -(n_bin_hist/2 + 1)*asd(m2) + 0.5*asd(m2)
                do m1=1,n_bin_hist,1
                    xcoor(m1,m2) = xcoor_low(m2) + m1*asd(m2)
                end do
            end do
!           Gets characters of the cut and "y or eta".
            write( cut_off(1,1),"(F7.2)" ) afl(1,2,1)
            write( cut_off(2,1),"(F7.2)" ) afl(1,2,2)
            write( cut_off(1,2),"(F7.2)" ) afl(1,1,1)
            write( cut_off(2,2),"(F7.2)" ) afl(1,1,2)
        end if
        cyeta = "  y  "
        if( i_y_or_eta == 1 ) cyeta = " eta "
!       Gets names of the specified particles in "usu.dat".
        do m3=1,ispmax,1
            call PYNAME( ispkf(m3), name_KF(m3) )
        end do

!-------------------------------------------------------------------------------
!       Outputs particle multiplicities and mean pT of total, charged , pi+K+p
!        and ispmax particles specified in usu.dat.
        write(10,*) "#!-------------------------------------"// &
                    "----------------------------------------"
        write(10,*) "#! particle multiplicity, partial (" // &
                    cut_off(1,1)//" < pT < "//cut_off(2,1)//";"// &
                    cut_off(1,2)//" <"//cyeta//"< "//cut_off(2,2) &
                    // "; nominal cuts of 1-st setting in usu.dat) ="
        write(10,*) "#! total                    charged" // &
                    "                   pi+K+p          ", &
                    ( "          "//name_KF(m3),m3=1,ispmax,1 )
        write(10,*) (sbo_mult(ll,1),ll=1,3,1), (sbo(ll,1),ll=1,ispmax,1)
        write(10,*) "#! particle multiplicity, full ="
        write(10,*) (sbo_mult_f(ll,1),ll=1,3,1),(sbof(ll,1),ll=1,ispmax)
        write(10,*) "#!-------------------------------------"// &
                    "----------------------------------------"
        write(10,*) "#! Number of particles for mean pT <pT>, partial (" &
                 // cut_off(1,1) // " < pT < " // cut_off(2,1) // ";" &
                 // cut_off(1,2) // " <"// cyeta // "< "// cut_off(2,2) &
                 // "; nominal cuts of 1-st setting in usu.dat) ="
        write(10,*) (sbn_mult(ll,1),ll=1,3,1), (sbn(ll,1),ll=1,ispmax,1)
        write(10,*) "#! Number of particles for mean pT <pT>, full ="
        write(10,*) (sbn_mult_f(ll,1),ll=1,3,1), (sbnf(ll,1),ll=1,ispmax,1)
        write(10,*) "#! Total pT of particles, partial (" // &
                    cut_off(1,1)//" < pT < "//cut_off(2,1)//";"// &
                    cut_off(1,2)//" <"//cyeta//"< "//cut_off(2,2) &
                    // "; nominal cuts of 1-st setting in usu.dat) ="
        write(10,*) (sbn_mult(ll,2),ll=1,3,1), (sbn(ll,2),ll=1,ispmax,1)
        write(10,*) "#! Total pT of particles, full ="
        write(10,*) (sbn_mult_f(ll,2),ll=1,3,1), (sbnf(ll,2),ll=1,ispmax,1)
        write(10,*) "#! particle mean pT <pT>, partial (" // &
                    cut_off(1,1)//" < pT < "//cut_off(2,1)//";"// &
                    cut_off(1,2)//" <"//cyeta//"< "//cut_off(2,2) &
                    // "; nominal cuts of 1-st setting in usu.dat) ="
        write(10,*) ( ( sbn_mult(ll,2) / MAX( sbn_mult(ll,1), 1D-10 ) ), &
                        ll=1,3,1 ), &
                    ( ( sbn(ll,2) / MAX( sbn(ll,1), 1D-10 ) ), &
                        ll=1,ispmax,1 )
        write(10,*) "#! particle mean pT <pT>, full ="
        write(10,*) ( ( sbn_mult_f(ll,2) / MAX( sbn_mult_f(ll,1), 1D-10 ) ), &
                        ll=1,3,1 ), &
                    ( ( sbnf(ll,2) / MAX( sbnf(ll,1), 1D-10 ) ), &
                        ll=1,ispmax,1 )

!-------------------------------------------------------------------------------
!       Outputs integral flows.
        write(10,*) "#!-------------------------------------" // &
                    "----------------------------------------"
        write(10,*) "#! Number of particles for integtral flows, partial (" &
                 // cut_off(1,1) // " < pT < " // cut_off(2,1) // ";" &
                 // cut_off(1,2) // " <"// cyeta // "< "// cut_off(2,2) &
                 // "; nominal cuts of 1-st setting in usu.dat) ="
        write(10,*) ( snum_particle_integral(ll,2), ll = 1,3,1 ), &
                    ( snum_h_integral(ll,2), ll = 1,ispmax,1 )
        write(10,*) "#! Number of particles for integtral flows, full ="
        write(10,*) ( snum_particle_integral(ll,1), ll = 1,3,1 ), &
                    ( snum_h_integral(ll,1), ll = 1,ispmax,1 )
        write(10,*) "#! Total integral flows, v1, v2, v3, v4, " &
                 // "partial (" &
                 // cut_off(1,1) // " < pT < " // cut_off(2,1) // ";" &
                 // cut_off(1,2) // " <"// cyeta // "< "// cut_off(2,2) &
                 // "; nominal cuts of 1-st setting in usu.dat) ="
        do i=1,4,1
            write(10,*) ( flow_particle_integral(ll,i,2), ll = 1,3,1 ), &
                        ( flow_h_integral(ll,i,2), ll = 1,ispmax,1 )
        end do
        write(10,*) "#! Total integral flows, v1, v2, v3, v4, full ="
        do i=1,4,1
            write(10,*) ( flow_particle_integral(ll,i,1), ll = 1,3,1 ), &
                        ( flow_h_integral(ll,i,1), ll = 1,ispmax,1 )
        end do
        write(10,*) "#! Particle number averaged integral flows, v1, v2, v3, " &
                 // "v4, partial (" &
                 // cut_off(1,1) // " < pT < " // cut_off(2,1) // ";" &
                 // cut_off(1,2) // " <"// cyeta // "< "// cut_off(2,2) &
                 // "; nominal cuts of 1-st setting in usu.dat) ="
        do i=1,4,1
            write(10,*) ( ( flow_particle_integral(ll,i,2) &
                            / MAX( snum_particle_integral(ll,2), 1D-10 ) ), &
                            ll = 1,3,1 ), &
                        ( ( flow_h_integral(ll,i,2) &
                            / MAX( snum_h_integral(ll,2), 1D-10 ) ), &
                            ll = 1,ispmax,1 )
        end do
        write(10,*) "#! Particle number averaged integral flows, v1, v2, v3, " &
                 // "v4, full ="
        do i=1,4,1
            write(10,*) ( ( flow_particle_integral(ll,i,1) &
                            / MAX( snum_particle_integral(ll,1), 1D-10 ) ), &
                            ll = 1,3,1 ), &
                        ( ( flow_h_integral(ll,i,1) &
                            / MAX( snum_h_integral(ll,1), 1D-10 ) ), &
                            ll = 1,ispmax,1 )
        end do

!===============================================================================
!       Outputs abscissa, 7-distributions of total, charged, pi+K+p and
!        ispmax particles specified in usu.dat.
        write(10,*)
        write(10,*)
        write(10,*)
!       Write header.
        write(10,*) "#!*******************|"// &
                    "    Hadron  Distribution  Output    "// &
                    "|******************!#"
        DO m2=1,isdmax,1
            ! '8' distributions are used for '7', i.e. mean <pT>.
            if( m2 == 8 ) cycle
!-------------------------------------------------------------------------------
            write(10,*) "#!-------------------------------------"// &
                        "----------------------------------------"
!-------------------------------------------------------------------------------
!           For partial phase-space.
!           Write name of distributions and cuts.
            write(10,*) "#! ID of distribution m2=",m2,"   "//id_distr(m2)
            if(m2 == 1 .OR. m2 == 3)then
                write(10,*) "#! partial phase-space, "// &
                            cut_off(1,1)//" < pT < "//cut_off(2,1)// &
                            "  (nominal cuts of 1-st setting in usu.dat)"
            end if
            if(m2 == 2 .OR. m2 == 4 .OR. m2 == 6)then
                write(10,*) "#! partial phase-space, "// &
                            cut_off(1,2)//" <"//cyeta//"< "//cut_off(2,2)// &
                            "  (nominal cuts of 1-st setting in usu.dat)"
            end if
            if(m2 == 5 .OR. m2 == 7)then   ! 300124 Lei
                write(10,*) "#! partial phase-space, "// &
                            cut_off(1,1)//" < pT < "//cut_off(2,1)//";"// &
                            cut_off(1,2)//" <"//cyeta//"< "//cut_off(2,2)// &
                            "  (nominal cuts of 1-st setting in usu.dat)"
            end if
!           Write name of abscissa and particles.
            write(10,*) "#!       "//id_abscissa(m2)// &
                        "                   total                     " // &
                        "charged                   pi+K+p        ", &
                        ( "          "//name_KF(m3),m3=1,ispmax,1 )
!           Write data.
            if( m2 /= 7 )then
                do m1=1,n_bin_hist,1
                    write(10,*) xcoor(m1,m2), ( sao_distr(m1,m2,m3),m3=1,3,1 ),&
                                            ( sao(m1,m2,m3),m3=1,ispmax,1 )
                end do
            else
                do m1=1,n_bin_hist,1
                    write(10,*) xcoor(m1,m2), &
                                ( ( san_distr(m1,7,m3) &
                                / MAX( san_distr(m1,8,m3) , 1D-10 ) ), &
                                m3=1,3,1 ),&
                                ( ( san(m1,7,m3) &
                                / MAX( san(m1,8,m3), 1D-10 ) ), &
                                m3=1,ispmax,1 )
                end do
            end if
!-------------------------------------------------------------------------------
!           For full phase-space.
!           Write name of distributions and cuts.
            write(10,*) "#! ID of distribution m2=",m2,"   "//id_distr(m2)
            write(10,*) "#! full phase-space"
!           Write name of abscissa and particles.
            write(10,*) "#!       "//id_abscissa(m2)// &
                        "                   total                     " // &
                        "charged                   pi+K+p        ", &
                        ( "          "//name_KF(m3),m3=1,ispmax,1 )
!           Write data.
            if( m2 /= 7 )then
                do m1=1,n_bin_hist,1
                    write(10,*) xcoor(m1,m2), ( sao_distr_f(m1,m2,m3),m3=1,3 ),&
                                            ( saof(m1,m2,m3),m3=1,ispmax,1 )
                end do
            else
                do m1=1,n_bin_hist,1
                    write(10,*) xcoor(m1,m2), &
                                ( ( san_distr_f(m1,7,m3) &
                                / MAX( san_distr_f(m1,8,m3) , 1D-10 ) ), &
                                m3=1,3,1 ),&
                                ( ( sanf(m1,7,m3) &
                                / MAX( sanf(m1,8,m3), 1D-10 ) ), &
                                m3=1,ispmax,1 )
                end do
            end if
!-------------------------------------------------------------------------------
!           For mean pT <pT>.
            if( m2 == 7 )then
                do m22 = 8,7,-1
                    ! Patial space.
                    if( m22 == 8 ) write(10,*) "#! Num of particles for mean pT"
                    if( m22 == 7 ) write(10,*) "#! Total pT"
                    write(10,*) "#! partial phase-space, " // &
                                cut_off(1,1) // " < pT < " // cut_off(2,1) &
                                // ";" // &
                                cut_off(1,2) // " <" // cyeta // "< " &
                                // cut_off(2,2) // &
                                " (nominal cuts of 1-st setting in usu.dat)"
                    write(10,*) "#!       "//id_abscissa(m2)// &
                        "                   total                     " // &
                        "charged                   pi+K+p        ", &
                        ( "          "//name_KF(m3),m3=1,ispmax,1 )
                    do m1=1,n_bin_hist,1
                        write(10,*) xcoor(m1,m2), &
                                    ( san_distr(m1,m22,m3), m3=1,3,1 ), &
                                    ( san(m1,m22,m3), m3=1,ispmax,1 )
                    end do
                    ! Full space.
                    if( m22 == 8 ) write(10,*) "#! Num of particles for mean pT"
                    if( m22 == 7 ) write(10,*) "#! Total pT"
                    write(10,*) "#! full phase-space"
                    write(10,*) "#!       "//id_abscissa(m2)// &
                        "                   total                     " // &
                        "charged                   pi+K+p        ", &
                        ( "          "//name_KF(m3),m3=1,ispmax,1 )
                    do m1=1,n_bin_hist,1
                        write(10,*) xcoor(m1,m2), &
                                    ( san_distr_f(m1,m22,m3), m3=1,3,1 ), &
                                    ( sanf(m1,m22,m3), m3=1,ispmax,1 )
                    end do
                end do
            end if
        END DO

!===============================================================================
!       Outputs differential flows.
        write(10,*)
        write(10,*)
        write(10,*)
!       Prints header.
        write(10,*) "#!***********************|"// &
                    "    Hadron  Flow  Output    "// &
                    "|**********************!#"
!       Particle number averaged v VS. y.
        DO m2=1,4,1
!-------------------------------------------------------------------------------
            write(10,*) "#!-------------------------------------"// &
                        "----------------------------------------"
!-------------------------------------------------------------------------------
!           For the partial phase-space.
!           Prints names of distributions and cuts.
            if( m2 == 1 )then
                write(10,*) "#! Particle number ave. directed flow, v1 VS. y"
            else if( m2 == 2 )then
                write(10,*) "#! Particle number ave. elliptic flow, v2 VS. y"
            else if( m2 == 3 )then
                write(10,*) "#! Particle number ave. triangular flow, v3 VS. y"
            else if( m2 == 4 )then
                write(10,*) "#! Particle num ave. quadrangular flow, v4 VS. y"
            end if
            write(10,*) "#! partial phase-space, "// &
                        cut_off(1,1)//" < pT < "//cut_off(2,1)// &
                        "  (nominal cuts of 1-st setting in usu.dat)"
!           Prints names of abscissa and particles.
            write(10,*) "#!       "//id_abscissa(1)// &
                        "                   total                     " // &
                        "charged                   pi+K+p        ", &
                        ( "          "//name_KF(m3),m3=1,ispmax,1 )
!           Prints data.
            do m1=1,n_bin_hist,1
                write(10,*) xcoor(m1,1), &
                            ( ( dvdy_particle(m1,m2,m3) &
                                / MAX( dNy_particle(m1,m3), 1D-10 ) ), &
                                m3=1,3,1 ), &
                            ( ( dvdy_h(m1,m2,m3) &
                                / MAX( dNy_h(m1,m3), 1D-10 ) ), &
                                m3=1,ispmax,1 )
            end do
!-------------------------------------------------------------------------------
!           For full phase-space.
!           Prints names of distributions and cuts.
            if( m2 == 1 )then
                write(10,*) "#! Particle number ave. directed flow, v1 VS. y"
            else if( m2 == 2 )then
                write(10,*) "#! Particle number ave. elliptic flow, v2 VS. y"
            else if( m2 == 3 )then
                write(10,*) "#! Particle number ave. triangular flow, v3 VS. y"
            else if( m2 == 4 )then
                write(10,*) "#! Particle num ave. quadrangular flow, v4 VS. y"
            end if
            write(10,*) "#! full phase-space"
!           Prints names of abscissa and particles.
            write(10,*) "#!       "//id_abscissa(1)// &
                        "                   total                     " // &
                        "charged                   pi+K+p        ", &
                        ( "          "//name_KF(m3),m3=1,ispmax,1 )
!           Prints data.
            do m1=1,n_bin_hist,1
                write(10,*) xcoor(m1,1), &
                            ( ( dvdy_particle_f(m1,m2,m3) &
                                / MAX( dNy_particle_f(m1,m3), 1D-10 ) ), &
                                m3=1,3,1 ), &
                            ( ( dvdy_h_f(m1,m2,m3) &
                                / MAX( dNy_h_f(m1,m3), 1D-10 ) ), &
                                m3=1,ispmax,1 )
            end do
        END DO
!-------------------------------------------------------------------------------
!       Particle number averagedv VS. pT.
        DO m2=1,4,1
!-------------------------------------------------------------------------------
            write(10,*) "#!-------------------------------------"// &
                        "----------------------------------------"
!           For the partial phase-space.
!           Prints names of distributions and cuts.
            if( m2 == 1 )then
                write(10,*) "#! Particle number ave. directed flow, v1 VS. pT"
            else if( m2 == 2 )then
                write(10,*) "#! Particle number ave. elliptic flow, v2 VS. pT"
            else if( m2 == 3 )then
                write(10,*) "#! Particle number ave. triangular flow, v3 VS. pT"
            else if( m2 == 4 )then
                write(10,*) "#! Particle num ave. quadrangular flow, v4 VS. pT"
            end if
            write(10,*) "#! partial phase-space, "// &
                        cut_off(1,2)//" <"//cyeta//"< "//cut_off(2,2)// &
                        "  (nominal cuts of 1-st setting in usu.dat)"
!           Prints names of abscissa and particles.
            write(10,*) "#!       "//id_abscissa(2)// &
                        "                   total                     " // &
                        "charged                   pi+K+p        ", &
                        ( "          "//name_KF(m3),m3=1,ispmax,1 )
!           Prints data.
            do m1=1,n_bin_hist,1
                write(10,*) xcoor(m1,2), &
                            ( ( dvdpT_particle(m1,m2,m3) &
                                / MAX( dNpT_particle(m1,m3), 1D-10 ) ), &
                                m3=1,3,1 ), &
                            ( ( dvdpT_h(m1,m2,m3) &
                                / MAX( dNpT_h(m1,m3), 1D-10 ) ), &
                                m3=1,ispmax,1 )
            end do
!-------------------------------------------------------------------------------
!           For full phase-space.
!           Prints names of distributions and cuts.
            if( m2 == 1 )then
                write(10,*) "#! Particle number ave. directed flow, v1 VS. pT"
            else if( m2 == 2 )then
                write(10,*) "#! Particle number ave. elliptic flow, v2 VS. pT"
            else if( m2 == 3 )then
                write(10,*) "#! Particle number ave. triangular flow, v3 VS. pT"
            else if( m2 == 4 )then
                write(10,*) "#! Particle num ave. quadrangular flow, v4 VS. pT"
            end if
            write(10,*) "#! full phase-space"
!           Prints names of abscissa and particles.
            write(10,*) "#!       "//id_abscissa(2)// &
                        "                   total                     " // &
                        "charged                   pi+K+p        ", &
                        ( "          "//name_KF(m3),m3=1,ispmax,1 )
!           Prints data.
            do m1=1,n_bin_hist,1
                write(10,*) xcoor(m1,2), &
                            ( ( dvdpT_particle_f(m1,m2,m3) &
                                / MAX( dNpT_particle_f(m1,m3), 1D-10 ) ), &
                                m3=1,3,1 ), &
                            ( ( dvdpT_h_f(m1,m2,m3) &
                                / MAX( dNpT_h_f(m1,m3), 1D-10 ) ), &
                                m3=1,ispmax,1 )
            end do
        END DO
!-------------------------------------------------------------------------------
!       Particle number averagedv VS. eta.
        DO m2=1,4,1
!-------------------------------------------------------------------------------
            write(10,*) "#!-------------------------------------"// &
                        "----------------------------------------"
!           For the partial phase-space.
!           Prints names of distributions and cuts.
            if( m2 == 1 )then
                write(10,*) "#! Particle number ave. directed flow, v1 VS. eta"
            else if( m2 == 2 )then
                write(10,*) "#! Particle number ave. elliptic flow, v2 VS. eta"
            else if( m2 == 3 )then
                write(10,*) "#! Particle num ave. triangular flow, v3 VS. eta"
            else if( m2 == 4 )then
                write(10,*) "#! Particle num ave. quadrangular flow, v4 VS. eta"
            end if
            write(10,*) "#! partial phase-space, "// &
                        cut_off(1,1)//" < pT < "//cut_off(2,1)// &
                        "  (nominal cuts of 1-st setting in usu.dat)"
!           Prints names of abscissa and particles.
            write(10,*) "#!       "//id_abscissa(3)// &
                        "                   total                     " // &
                        "charged                   pi+K+p        ", &
                        ( "          "//name_KF(m3),m3=1,ispmax,1 )
!           Prints data.
            do m1=1,n_bin_hist,1
                write(10,*) xcoor(m1,3), &
                            ( ( dvdeta_particle(m1,m2,m3) &
                                / MAX( dNeta_particle(m1,m3), 1D-10 ) ), &
                                m3=1,3,1 ), &
                            ( ( dvdeta_h(m1,m2,m3) &
                                / MAX( dNeta_h(m1,m3), 1D-10 ) ), &
                                m3=1,ispmax,1 )
            end do
!-------------------------------------------------------------------------------
!           For full phase-space.
!           Prints names of distributions and cuts.
            if( m2 == 1 )then
                write(10,*) "#! Particle number ave. directed flow, v1 VS. eta"
            else if( m2 == 2 )then
                write(10,*) "#! Particle number ave. elliptic flow, v2 VS. eta"
            else if( m2 == 3 )then
                write(10,*) "#! Particle num ave. triangular flow, v3 VS. eta"
            else if( m2 == 4 )then
                write(10,*) "#! Particle num ave. quadrangular flow, v4 VS. eta"
            end if
            write(10,*) "#! full phase-space"
!           Prints names of abscissa and particles.
            write(10,*) "#!       "//id_abscissa(3)// &
                        "                   total                     " // &
                        "charged                   pi+K+p        ", &
                        ( "          "//name_KF(m3),m3=1,ispmax,1 )
!           Prints data.
            do m1=1,n_bin_hist,1
                write(10,*) xcoor(m1,3), &
                            ( ( dvdeta_particle_f(m1,m2,m3) &
                                / MAX( dNeta_particle_f(m1,m3), 1D-10 ) ), &
                                m3=1,3,1 ), &
                            ( ( dvdeta_h_f(m1,m2,m3) &
                                / MAX( dNeta_h_f(m1,m3), 1D-10 ) ), &
                                m3=1,ispmax,1 )
            end do
        END DO

!-------------------------------------------------------------------------------
!       Total number of particles for differential flows.
        DO m2=1,3,1
!-------------------------------------------------------------------------------
            write(10,*) "#!-------------------------------------"// &
                        "----------------------------------------"
!           For the partial phase-space.
            if( m2 == 1 )then
!           Prints names of distributions and cuts.
                write(10,*) "#! Num of particles for diff. flows, N VS. y"
                write(10,*) "#! partial phase-space, "// &
                            cut_off(1,1)//" < pT < "//cut_off(2,1)// &
                            "  (nominal cuts of 1-st setting in usu.dat)"
!           Prints names of abscissa and particles.
                write(10,*) "#!       "//id_abscissa(m2)// &
                            "                   total                     " // &
                            "charged                   pi+K+p        ", &
                            ( "          "//name_KF(m3),m3=1,ispmax,1 )
!           Prints data.
                do m1=1,n_bin_hist,1
                    write(10,*) xcoor(m1,m2), &
                                ( dNy_particle(m1,m3), m3=1,3,1 ), &
                                ( dNy_h(m1,m3), m3=1,ispmax,1 )
                end do
            else if( m2 == 2 )then
!           Prints names of distributions and cuts.
                write(10,*) "#! Num of particles for diff. flows, N VS. pT"
                write(10,*) "#! partial phase-space, "// &
                            cut_off(1,2)//" <"//cyeta//"< "//cut_off(2,2)// &
                            "  (nominal cuts of 1-st setting in usu.dat)"
!           Prints names of abscissa and particles.
                write(10,*) "#!       "//id_abscissa(m2)// &
                            "                   total                     " // &
                            "charged                   pi+K+p        ", &
                            ( "          "//name_KF(m3),m3=1,ispmax,1 )
!           Prints data.
                do m1=1,n_bin_hist,1
                    write(10,*) xcoor(m1,m2), &
                                ( dNpT_particle(m1,m3), m3=1,3,1 ), &
                                ( dNpT_h(m1,m3), m3=1,ispmax,1 )
                end do
            else if( m2 == 3 )then
!           Prints names of distributions and cuts.
                write(10,*) "#! Num of particles for diff. flows, N VS. eta"
                write(10,*) "#! partial phase-space, "// &
                            cut_off(1,1)//" < pT < "//cut_off(2,1)// &
                            "  (nominal cuts of 1-st setting in usu.dat)"
!           Prints names of abscissa and particles.
                write(10,*) "#!       "//id_abscissa(m2)// &
                            "                   total                     " // &
                            "charged                   pi+K+p        ", &
                            ( "          "//name_KF(m3),m3=1,ispmax,1 )
!           Prints data.
                do m1=1,n_bin_hist,1
                    write(10,*) xcoor(m1,m2), &
                                ( dNeta_particle(m1,m3), m3=1,3,1 ), &
                                ( dNeta_h(m1,m3), m3=1,ispmax,1 )
                end do
            end if
!           For the full phase-space.
            if( m2 == 1 )then
!           Prints names of distributions and cuts.
                write(10,*) "#! Num of particles for diff. flows, N VS. y"
                write(10,*) "#! full phase-space"
!           Prints names of abscissa and particles.
                write(10,*) "#!       "//id_abscissa(m2)// &
                            "                   total                     " // &
                            "charged                   pi+K+p        ", &
                            ( "          "//name_KF(m3),m3=1,ispmax,1 )
!           Prints data.
                do m1=1,n_bin_hist,1
                    write(10,*) xcoor(m1,m2), &
                                ( dNy_particle_f(m1,m3), m3=1,3,1 ), &
                                ( dNy_h_f(m1,m3), m3=1,ispmax,1 )
                end do
            else if( m2 == 2 )then
!           Prints names of distributions and cuts.
                write(10,*) "#! Num of particles for diff. flows, N VS. pT"
                write(10,*) "#! full phase-space"
!           Prints names of abscissa and particles.
                write(10,*) "#!       "//id_abscissa(m2)// &
                            "                   total                     " // &
                            "charged                   pi+K+p        ", &
                            ( "          "//name_KF(m3),m3=1,ispmax,1 )
!           Prints data.
                do m1=1,n_bin_hist,1
                    write(10,*) xcoor(m1,m2), &
                                ( dNpT_particle_f(m1,m3), m3=1,3,1 ), &
                                ( dNpT_h_f(m1,m3), m3=1,ispmax,1 )
                end do
            else if( m2 == 3 )then
!           Prints names of distributions and cuts.
                write(10,*) "#! Num of particles for diff. flows, N VS. eta"
                write(10,*) "#! full phase-space"
!           Prints names of abscissa and particles.
                write(10,*) "#!       "//id_abscissa(m2)// &
                            "                   total                     " // &
                            "charged                   pi+K+p        ", &
                            ( "          "//name_KF(m3),m3=1,ispmax,1 )
!           Prints data.
                do m1=1,n_bin_hist,1
                    write(10,*) xcoor(m1,m2), &
                                ( dNeta_particle_f(m1,m3), m3=1,3,1 ), &
                                ( dNeta_h_f(m1,m3), m3=1,ispmax,1 )
                end do
            end if
        END DO

!-------------------------------------------------------------------------------
!       Total v VS. y.
        DO m2=1,4,1
!-------------------------------------------------------------------------------
            write(10,*) "#!-------------------------------------"// &
                        "----------------------------------------"
!           For the partial phase-space.
!           Prints names of distributions and cuts.
            if( m2 == 1 )then
                write(10,*) "#! Total directed flow, v1 VS. y"
            else if( m2 == 2 )then
                write(10,*) "#! Total elliptic flow, v2 VS. y"
            else if( m2 == 3 )then
                write(10,*) "#! Total triangular flow, v3 VS. y"
            else if( m2 == 4 )then
                write(10,*) "#! Total quadrangular flow, v4 VS. y"
            end if
            write(10,*) "#! partial phase-space, "// &
                        cut_off(1,1)//" < pT < "//cut_off(2,1)// &
                        "  (nominal cuts of 1-st setting in usu.dat)"
!           Prints names of abscissa and particles.
            write(10,*) "#!       "//id_abscissa(1)// &
                        "                   total                     " // &
                        "charged                   pi+K+p        ", &
                        ( "          "//name_KF(m3),m3=1,ispmax,1 )
!           Prints data.
            do m1=1,n_bin_hist,1
                write(10,*) xcoor(m1,1), &
                            ( dvdy_particle(m1,m2,m3), m3=1,3,1 ), &
                            ( dvdy_h(m1,m2,m3), m3=1,ispmax,1 )
            end do
!-------------------------------------------------------------------------------
!           For full phase-space.
!           Prints names of distributions and cuts.
            if( m2 == 1 )then
                write(10,*) "#! Total directed flow, v1 VS. y"
            else if( m2 == 2 )then
                write(10,*) "#! Total elliptic flow, v2 VS. y"
            else if( m2 == 3 )then
                write(10,*) "#! Total triangular flow, v3 VS. y"
            else if( m2 == 4 )then
                write(10,*) "#! Total quadrangular flow, v4 VS. y"
            end if
            write(10,*) "#! full phase-space"
!           Prints names of abscissa and particles.
            write(10,*) "#!       "//id_abscissa(1)// &
                        "                   total                     " // &
                        "charged                   pi+K+p        ", &
                        ( "          "//name_KF(m3),m3=1,ispmax,1 )
!           Prints data.
            do m1=1,n_bin_hist,1
                write(10,*) xcoor(m1,1), &
                            ( dvdy_particle_f(m1,m2,m3), m3=1,3,1 ), &
                            ( dvdy_h_f(m1,m2,m3), m3=1,ispmax,1 )
            end do
        END DO
!-------------------------------------------------------------------------------
!       Total v VS. pT.
        DO m2=1,4,1
!-------------------------------------------------------------------------------
            write(10,*) "#!-------------------------------------"// &
                        "----------------------------------------"
!           For the partial phase-space.
!           Prints names of distributions and cuts.
            if( m2 == 1 )then
                write(10,*) "#! Total directed flow, v1 VS. pT"
            else if( m2 == 2 )then
                write(10,*) "#! Total elliptic flow, v2 VS. pT"
            else if( m2 == 3 )then
                write(10,*) "#! Total triangular flow, v3 VS. pT"
            else if( m2 == 4 )then
                write(10,*) "#! Total quadrangular flow, v4 VS. pT"
            end if
            write(10,*) "#! partial phase-space, "// &
                        cut_off(1,2)//" <"//cyeta//"< "//cut_off(2,2)// &
                        "  (nominal cuts of 1-st setting in usu.dat)"
!           Prints names of abscissa and particles.
            write(10,*) "#!       "//id_abscissa(2)// &
                        "                   total                     " // &
                        "charged                   pi+K+p        ", &
                        ( "          "//name_KF(m3),m3=1,ispmax,1 )
!           Prints data.
            do m1=1,n_bin_hist,1
                write(10,*) xcoor(m1,2), &
                            ( dvdpT_particle(m1,m2,m3), m3=1,3,1 ), &
                            ( dvdpT_h(m1,m2,m3), m3=1,ispmax,1 )
            end do
!-------------------------------------------------------------------------------
!           For full phase-space.
!           Prints names of distributions and cuts.
            if( m2 == 1 )then
                write(10,*) "#! Total directed flow, v1 VS. pT"
            else if( m2 == 2 )then
                write(10,*) "#! Total elliptic flow, v2 VS. pT"
            else if( m2 == 3 )then
                write(10,*) "#! Total triangular flow, v3 VS. pT"
            else if( m2 == 4 )then
                write(10,*) "#! Total quadrangular flow, v4 VS. pT"
            end if
            write(10,*) "#! full phase-space"
!           Prints names of abscissa and particles.
            write(10,*) "#!       "//id_abscissa(2)// &
                        "                   total                     " // &
                        "charged                   pi+K+p        ", &
                        ( "          "//name_KF(m3),m3=1,ispmax,1 )
!           Prints data.
            do m1=1,n_bin_hist,1
                write(10,*) xcoor(m1,2), &
                            ( dvdpT_particle_f(m1,m2,m3), m3=1,3,1 ), &
                            ( dvdpT_h_f(m1,m2,m3), m3=1,ispmax,1 )
            end do
        END DO
!-------------------------------------------------------------------------------
!       Total v VS. eta.
        DO m2=1,4,1
!-------------------------------------------------------------------------------
            write(10,*) "#!-------------------------------------"// &
                        "----------------------------------------"
!           For the partial phase-space.
!           Prints names of distributions and cuts.
            if( m2 == 1 )then
                write(10,*) "#! Total directed flow, v1 VS. eta"
            else if( m2 == 2 )then
                write(10,*) "#! Total elliptic flow, v2 VS. eta"
            else if( m2 == 3 )then
                write(10,*) "#! Total triangular flow, v3 VS. eta"
            else if( m2 == 4 )then
                write(10,*) "#! Total quadrangular flow, v4 VS. eta"
            end if
            write(10,*) "#! partial phase-space, "// &
                        cut_off(1,1)//" < pT < "//cut_off(2,1)// &
                        "  (nominal cuts of 1-st setting in usu.dat)"
!           Prints names of abscissa and particles.
            write(10,*) "#!       "//id_abscissa(3)// &
                        "                   total                     " // &
                        "charged                   pi+K+p        ", &
                        ( "          "//name_KF(m3),m3=1,ispmax,1 )
!           Prints data.
            do m1=1,n_bin_hist,1
                write(10,*) xcoor(m1,3), &
                            ( dvdeta_particle(m1,m2,m3), m3=1,3,1 ), &
                            ( dvdeta_h(m1,m2,m3), m3=1,ispmax,1 )
            end do
!-------------------------------------------------------------------------------
!           For full phase-space.
!           Prints names of distributions and cuts.
            if( m2 == 1 )then
                write(10,*) "#! Total directed flow, v1 VS. eta"
            else if( m2 == 2 )then
                write(10,*) "#! Total elliptic flow, v2 VS. eta"
            else if( m2 == 3 )then
                write(10,*) "#! Total triangular flow, v3 VS. eta"
            else if( m2 == 4 )then
                write(10,*) "#! Total quadrangular flow, v4 VS. eta"
            end if
            write(10,*) "#! full phase-space"
!           Prints names of abscissa and particles.
            write(10,*) "#!       "//id_abscissa(3)// &
                        "                   total                     " // &
                        "charged                   pi+K+p        ", &
                        ( "          "//name_KF(m3),m3=1,ispmax,1 )
!           Prints data.
            do m1=1,n_bin_hist,1
                write(10,*) xcoor(m1,3), &
                            ( dvdeta_particle_f(m1,m2,m3), m3=1,3,1 ), &
                            ( dvdeta_h_f(m1,m2,m3), m3=1,ispmax,1 )
            end do
        END DO


        return
        end



!ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
        subroutine output_parton_distribution(sum_weight_event)
!       Outpouts seven distributions of partons.
        IMPLICIT DOUBLE PRECISION(A-H, O-Z)
        IMPLICIT INTEGER(I-N)
        PARAMETER (KSZJ=80000)
        COMMON/PYJETS/N,NPAD,K(KSZJ,5),P(KSZJ,5),V(KSZJ,5)
        common/sa1/kjp21,non1,bp,iii,neve,nout,nosc
        common/sa7/ispmax,isdmax,iflmax,ispkf(100),n_bin_hist,asd(10), &
         afl(100,10,2),i_y_or_eta
!       u, ubar, d, dbar, s, sbar, c, cbar, b, bbar, t, tbar, g, (u+d+s + anti-)
        common/anly2/ sn_min_p, sn_min_p_f, sn_cha_p, sn_cha_p_f, sn_g, &
        sn_g_f,san_p(100,10,20),sbn_p(20,2),san_p_f(100,10,20),sbn_p_f(20,2)
        dimension xcoor(100,10),xcoor_low(10)
        character*7 cut_off(2,2)
        character*4 id_abscissa(10)
        ! data id_abscissa / "y", "pT", "eta", "mT", "mult", "pT", "mult", .../
        character*50 id_distr(10)
    !     data id_distr / "dN/dy VS. y", "(1/pT)dN/dpT VS. pT", &
    !                     "dN/deta VS. eta", "(1/mT)dN/dmT VS. mT", &
    !                     "event-wise multiplicity", "dN/dpT VS. pT", &
    !                     "mean pT <pT> VS. event-wise multiplicity", ... /
        common/anly3/ xcoor, xcoor_low, cut_off, id_abscissa, id_distr
        common/ flow_p / snum_p_integral(20,2),   &
                         flow_p_integral(20,4,2), &
                         dNy_p_f(100,20),      &
                         dNy_p(100,20),        &
                         dNpT_p_f(100,20),     &
                         dNpT_p(100,20),       &
                         dNeta_p_f(100,20),    &
                         dNeta_p(100,20),      &
                         dvdy_p_f(100,4,20),   &
                         dvdy_p(100,4,20),     &
                         dvdpT_p_f(100,4,20),  &
                         dvdpT_p(100,4,20),    &
                         dvdeta_p_f(100,4,20), &
                         dvdeta_p(100,4,20)
        character*5 cyeta


!-------------------------------------------------------------------------------
        swt = sum_weight_event
        cyeta = "  y  "
        if( i_y_or_eta == 1 ) cyeta = " eta "
        write(10,*)
        write(10,*)
        write(10,*)

!-------------------------------------------------------------------------------
!       Outputs particle multiplicities and mean pT of partons.
        write(10,*) "#!-------------------------------------"// &
                    "----------------------------------------"
        write(10,*) "#! multiplicity of negative, positive quark, "// &
                    "sums and gluon, partial & full ="
        write(10,*) sn_min_p/swt, sn_cha_p/swt, (sn_min_p+sn_cha_p)/swt, &
                    sn_g/swt
        write(10,*) sn_min_p_f/swt, sn_cha_p_f/swt, &
                    (sn_min_p_f+sn_cha_p_f)/swt, sn_g_f/swt

        write(10,*) "#!-------------------------------------"// &
                    "----------------------------------------"
        write(10,*) "#! particle multiplicity, partial (" // &
                    cut_off(1,1)//" < pT < "//cut_off(2,1)//";"// &
                    cut_off(1,2)//" <"//cyeta//"< "//cut_off(2,2)//") ="
        write(10,*)  &  ! Hardcode
              "#! g                        u+d+s + anti-             " // &
              "u                         ubar                      "   // &
              "d                         dbar                      "   // &
              "s                         sbar                      "   // &
              "c                         cbar                      "   // &
              "b                         bbar                      "   // &
              "t                         tbar                      "   // &
              "diquarks"
        write(10,*) (sbn_p(ll,1)/swt,ll=1,15,1)
        write(10,*) "#! particle multiplicity, full ="
        write(10,*) (sbn_p_f(ll,1)/swt,ll=1,15,1)
        write(10,*) "#!-------------------------------------"// &
                    "----------------------------------------"
        write(10,*) "#! Number of particles for mean pT <pT>, partial (" &
                 // cut_off(1,1) // " < pT < " // cut_off(2,1) // ";" &
                 // cut_off(1,2) // " <"// cyeta // "< "// cut_off(2,2) // ") ="
        write(10,*) (sbn_p(ll,1),ll=1,15,1)
        write(10,*) "#! Number of particles for mean pT <pT>, full ="
        write(10,*) (sbn_p_f(ll,1),ll=1,15,1)
        write(10,*) "#! Total pT of particles, partial (" // &
                    cut_off(1,1)//" < pT < "//cut_off(2,1)//";"// &
                    cut_off(1,2)//" <"//cyeta//"< "//cut_off(2,2) // ") ="
        write(10,*) (sbn_p(ll,2),ll=1,15,1)
        write(10,*) "#! Total pT of particles, full ="
        write(10,*) (sbn_p_f(ll,2),ll=1,15,1)
        write(10,*) "#! particle mean pT <pT>, partial (" // &
                    cut_off(1,1)//" < pT < "//cut_off(2,1)//";"// &
                    cut_off(1,2)//" <"//cyeta//"< "//cut_off(2,2)//") ="
        write(10,*) ( ( sbn_p(ll,2) / MAX( sbn_p(ll,1), 1D-10 ) ), &
                        ll=1,15,1 )
        write(10,*) "#! particle mean pT <pT>, full ="
        write(10,*) ( ( sbn_p_f(ll,2) / MAX( sbn_p_f(ll,1), 1D-10 ) ), &
                        ll=1,15,1)

!-------------------------------------------------------------------------------
!       Outputs integral flows.
        write(10,*) "#!-------------------------------------" // &
                    "----------------------------------------"
        write(10,*) "#! Number of particles for integtral flows, partial (" &
                 // cut_off(1,1) // " < pT < " // cut_off(2,1) // ";" &
                 // cut_off(1,2) // " <"// cyeta // "< "// cut_off(2,2) // ") ="
        write(10,*) ( snum_p_integral(ll,2), ll = 1,15,1 )
        write(10,*) "#! Number of particles for integtral flows, full ="
        write(10,*) ( snum_p_integral(ll,1), ll = 1,15,1 )
        write(10,*) "#! Total integral flows, v1, v2, v3, v4, " &
                 // "partial (" &
                 // cut_off(1,1) // " < pT < " // cut_off(2,1) // ";" &
                 // cut_off(1,2) // " <"// cyeta // "< "// cut_off(2,2) // ") ="
        do i=1,4,1
            write(10,*) ( flow_p_integral(ll,i,2), ll = 1,15,1 )
        end do
        write(10,*) "#! Total integral flows, v1, v2, v3, v4, full ="
        do i=1,4,1
            write(10,*) ( flow_p_integral(ll,i,1), ll = 1,15,1 )
        end do
        write(10,*) "#! Particle number averaged integral flows, v1, v2, v3, " &
                 // "v4, partial (" &
                 // cut_off(1,1) // " < pT < " // cut_off(2,1) // ";" &
                 // cut_off(1,2) // " <"// cyeta // "< "// cut_off(2,2) // ") ="
        do i=1,4,1
            write(10,*) ( ( flow_p_integral(ll,i,2) &
                            / MAX( snum_p_integral(ll,2), 1D-10 ) ), &
                            ll = 1,15,1 )
        end do
        write(10,*) "#! Particle number averaged integral flows, v1, v2, v3, " &
                 // "v4, full ="
        do i=1,4,1
            write(10,*) ( ( flow_p_integral(ll,i,1) &
                            / MAX( snum_p_integral(ll,1), 1D-10 ) ), &
                            ll = 1,15,1 )
        end do

!===============================================================================
!       Outputs abscissa, 7-distributions of g, u+d+s + anti- and q.
        write(10,*)
        write(10,*)
        write(10,*)
!       Write header.
        write(10,*) "#!*******************|"// &
                    "    Parton  Distribution  Output    "// &
                    "|******************!#"
        DO m2=1,isdmax,1
            ! '8' distributions are used for '7', i.e. mean <pT>.
            if( m2 == 8 ) cycle
!-------------------------------------------------------------------------------
            write(10,*) "#!-------------------------------------"// &
                        "----------------------------------------"
!-------------------------------------------------------------------------------
!           For partial phase-space.
!           Write name of distributions and cuts.
            write(10,*)"#! ID of distribution m2=",m2,"   "//id_distr(m2)
            if(m2 == 1 .OR. m2 == 3)then
                write(10,*) "#! partial phase-space, "// &
                            cut_off(1,1)//" < pT < "//cut_off(2,1)// &
                            "  (nominal cuts of 1-st setting in usu.dat)"
            end if
            if(m2 == 2 .OR. m2 == 4 .OR. m2 == 6)then
                write(10,*) "#! partial phase-space, "// &
                            cut_off(1,2)//" <"//cyeta//"< "//cut_off(2,2)// &
                            "  (nominal cuts of 1-st setting in usu.dat)"
            end if
            if(m2 == 5 .OR. m2 == 7)then
                write(10,*) "#! partial phase-space, "// &
                            cut_off(1,1)//" < pT < "//cut_off(2,1)//";"// &
                            cut_off(1,2)//" <"//cyeta//"< "//cut_off(2,2)// &
                            "  (nominal cuts of 1-st setting in usu.dat)"
            end if
!           Write name of abscissa and particles.
            write(10,*)  "#!       "//id_abscissa(m2)//"               " // &
                  "g                         u+d+s + anti-             " // &
                  "u                         ubar                      " // &
                  "d                         dbar                      " // &
                  "s                         sbar                      " // &
                  "c                         cbar                      " // &
                  "b                         bbar                      " // &
                  "t                         tbar                      " // &
                  "diquarks"
!           Write data.
            if( m2 /= 7 )then
                do m1=1,n_bin_hist,1
                    write(10,*) xcoor(m1,m2), (san_p(m1,m2,m3)/swt,m3=1,15,1)
                enddo
            else
                do m1=1,n_bin_hist,1
                    write(10,*) xcoor(m1,m2), &
                                ( ( san_p(m1,7,m3) &
                                / MAX( san_p(m1,8,m3) , 1D-10 ) ), &
                                m3=1,15,1 )
                end do
            end if
!-------------------------------------------------------------------------------
!           For full phase-space.
!           Write name of distributions and cuts.
            write(10,*) "#! ID of distribution m2=",m2,"   "//id_distr(m2)
            write(10,*) "#! full phase-space"
!           Write name of abscissa and particles.
            write(10,*)  "#!       "//id_abscissa(m2)//"               " // &
                  "g                         u+d+s + anti-             " // &
                  "u                         ubar                      " // &
                  "d                         dbar                      " // &
                  "s                         sbar                      " // &
                  "c                         cbar                      " // &
                  "b                         bbar                      " // &
                  "t                         tbar                      " // &
                  "diquarks"
!           Write data.
            if( m2 /= 7 )then
                do m1=1,n_bin_hist,1
                    write(10,*) xcoor(m1,m2),(san_p_f(m1,m2,m3)/swt,m3=1,15,1)
                end do
            else
                do m1=1,n_bin_hist,1
                    write(10,*) xcoor(m1,m2), &
                                ( ( san_p_f(m1,7,m3) &
                                / MAX( san_p_f(m1,8,m3) , 1D-10 ) ), &
                                m3=1,15,1 )
                end do
            end if
!-------------------------------------------------------------------------------
!           For mean pT <pT>.
            if( m2 == 7 )then
                do m22 = 8,7,-1
                    ! Patial space.
                    if( m22 == 8 ) write(10,*) "#! Num of particles for mean pT"
                    if( m22 == 7 ) write(10,*) "#! Total pT"
                    write(10,*) "#! partial phase-space, " // &
                                cut_off(1,1) // " < pT < " // cut_off(2,1) &
                                // ";" // &
                                cut_off(1,2) // " <" // cyeta // "< " &
                                // cut_off(2,2) // &
                                " (nominal cuts of 1-st setting in usu.dat)"
                    write(10,*)  &
                            "#!       "//id_abscissa(m2)//"               " // &
                     "g                         u+d+s + anti-             " // &
                     "u                         ubar                      " // &
                     "d                         dbar                      " // &
                     "s                         sbar                      " // &
                     "c                         cbar                      " // &
                     "b                         bbar                      " // &
                     "t                         tbar                      " // &
                     "diquarks"
                    do m1=1,n_bin_hist,1
                        write(10,*) xcoor(m1,m2), &
                                    ( san_p(m1,m22,m3), m3=1,15,1 )
                    end do
                    ! Full space.
                    if( m22 == 8 ) write(10,*) "#! Num of particles for mean pT"
                    if( m22 == 7 ) write(10,*) "#! Total pT"
                    write(10,*) "#! full phase-space"
                    write(10,*)  &
                            "#!       "//id_abscissa(m2)//"               " // &
                     "g                         u+d+s + anti-             " // &
                     "u                         ubar                      " // &
                     "d                         dbar                      " // &
                     "s                         sbar                      " // &
                     "c                         cbar                      " // &
                     "b                         bbar                      " // &
                     "t                         tbar                      " // &
                     "diquarks"
                    do m1=1,n_bin_hist,1
                        write(10,*) xcoor(m1,m2), &
                                    ( san_p_f(m1,m22,m3), m3=1,15,1 )
                    end do
                end do
            end if
        END DO

!===============================================================================
!       Outputs differential flows.
        write(10,*)
        write(10,*)
        write(10,*)
!       Prints header.
        write(10,*) "#!***********************|"// &
                    "    Parton  Flow  Output    "// &
                    "|**********************!#"
!       Particle number averaged v VS. y.
        DO m2=1,4,1
!-------------------------------------------------------------------------------
            write(10,*) "#!-------------------------------------"// &
                        "----------------------------------------"
!-------------------------------------------------------------------------------
!           For the partial phase-space.
!           Prints names of distributions and cuts.
            if( m2 == 1 )then
                write(10,*) "#! Particle number ave. directed flow, v1 VS. y"
            else if( m2 == 2 )then
                write(10,*) "#! Particle number ave. elliptic flow, v2 VS. y"
            else if( m2 == 3 )then
                write(10,*) "#! Particle number ave. triangular flow, v3 VS. y"
            else if( m2 == 4 )then
                write(10,*) "#! Particle num ave. quadrangular flow, v4 VS. y"
            end if
            write(10,*) "#! partial phase-space, "// &
                        cut_off(1,1)//" < pT < "//cut_off(2,1)// &
                        "  (nominal cuts of 1-st setting in usu.dat)"
!           Prints names of abscissa and particles.
            write(10,*)  "#!       "//id_abscissa(1)//"               " // &
                  "g                         u+d+s + anti-             " // &
                  "u                         ubar                      " // &
                  "d                         dbar                      " // &
                  "s                         sbar                      " // &
                  "c                         cbar                      " // &
                  "b                         bbar                      " // &
                  "t                         tbar                      " // &
                  "diquarks"
!           Prints data.
            do m1=1,n_bin_hist,1
                write(10,*) xcoor(m1,1), &
                            ( ( dvdy_p(m1,m2,m3) &
                                / MAX( dNy_p(m1,m3), 1D-10 ) ), &
                                m3=1,15,1 )
            end do
!-------------------------------------------------------------------------------
!           For full phase-space.
!           Prints names of distributions and cuts.
            if( m2 == 1 )then
                write(10,*) "#! Particle number ave. directed flow, v1 VS. y"
            else if( m2 == 2 )then
                write(10,*) "#! Particle number ave. elliptic flow, v2 VS. y"
            else if( m2 == 3 )then
                write(10,*) "#! Particle number ave. triangular flow, v3 VS. y"
            else if( m2 == 4 )then
                write(10,*) "#! Particle num ave. quadrangular flow, v4 VS. y"
            end if
            write(10,*) "#! full phase-space"
!           Prints names of abscissa and particles.
            write(10,*)  "#!       "//id_abscissa(1)//"               " // &
                  "g                         u+d+s + anti-             " // &
                  "u                         ubar                      " // &
                  "d                         dbar                      " // &
                  "s                         sbar                      " // &
                  "c                         cbar                      " // &
                  "b                         bbar                      " // &
                  "t                         tbar                      " // &
                  "diquarks"
!           Prints data.
            do m1=1,n_bin_hist,1
                write(10,*) xcoor(m1,1), &
                            ( ( dvdy_p_f(m1,m2,m3) &
                                / MAX( dNy_p_f(m1,m3), 1D-10 ) ), &
                                m3=1,15,1 )
            end do
        END DO
!-------------------------------------------------------------------------------
!       Particle number averagedv VS. pT.
        DO m2=1,4,1
!-------------------------------------------------------------------------------
            write(10,*) "#!-------------------------------------"// &
                        "----------------------------------------"
!           For the partial phase-space.
!           Prints names of distributions and cuts.
            if( m2 == 1 )then
                write(10,*) "#! Particle number ave. directed flow, v1 VS. pT"
            else if( m2 == 2 )then
                write(10,*) "#! Particle number ave. elliptic flow, v2 VS. pT"
            else if( m2 == 3 )then
                write(10,*) "#! Particle number ave. triangular flow, v3 VS. pT"
            else if( m2 == 4 )then
                write(10,*) "#! Particle num ave. quadrangular flow, v4 VS. pT"
            end if
            write(10,*) "#! partial phase-space, "// &
                        cut_off(1,2)//" <"//cyeta//"< "//cut_off(2,2)// &
                        "  (nominal cuts of 1-st setting in usu.dat)"
!           Prints names of abscissa and particles.
            write(10,*)  "#!       "//id_abscissa(2)//"               " // &
                  "g                         u+d+s + anti-             " // &
                  "u                         ubar                      " // &
                  "d                         dbar                      " // &
                  "s                         sbar                      " // &
                  "c                         cbar                      " // &
                  "b                         bbar                      " // &
                  "t                         tbar                      " // &
                  "diquarks"
!           Prints data.
            do m1=1,n_bin_hist,1
                write(10,*) xcoor(m1,2), &
                            ( ( dvdpT_p(m1,m2,m3) &
                                / MAX( dNpT_p(m1,m3), 1D-10 ) ), &
                                m3=1,15,1 )
            end do
!-------------------------------------------------------------------------------
!           For full phase-space.
!           Prints names of distributions and cuts.
            if( m2 == 1 )then
                write(10,*) "#! Particle number ave. directed flow, v1 VS. pT"
            else if( m2 == 2 )then
                write(10,*) "#! Particle number ave. elliptic flow, v2 VS. pT"
            else if( m2 == 3 )then
                write(10,*) "#! Particle number ave. triangular flow, v3 VS. pT"
            else if( m2 == 4 )then
                write(10,*) "#! Particle num ave. quadrangular flow, v4 VS. pT"
            end if
            write(10,*) "#! full phase-space"
!           Prints names of abscissa and particles.
            write(10,*)  "#!       "//id_abscissa(2)//"               " // &
                  "g                         u+d+s + anti-             " // &
                  "u                         ubar                      " // &
                  "d                         dbar                      " // &
                  "s                         sbar                      " // &
                  "c                         cbar                      " // &
                  "b                         bbar                      " // &
                  "t                         tbar                      " // &
                  "diquarks"
!           Prints data.
            do m1=1,n_bin_hist,1
                write(10,*) xcoor(m1,2), &
                            ( ( dvdpT_p_f(m1,m2,m3) &
                                / MAX( dNpT_p_f(m1,m3), 1D-10 ) ), &
                                m3=1,15,1 )
            end do
        END DO
!-------------------------------------------------------------------------------
!       Particle number averagedv VS. eta.
        DO m2=1,4,1
!-------------------------------------------------------------------------------
            write(10,*) "#!-------------------------------------"// &
                        "----------------------------------------"
!           For the partial phase-space.
!           Prints names of distributions and cuts.
            if( m2 == 1 )then
                write(10,*) "#! Particle number ave. directed flow, v1 VS. eta"
            else if( m2 == 2 )then
                write(10,*) "#! Particle number ave. elliptic flow, v2 VS. eta"
            else if( m2 == 3 )then
                write(10,*) "#! Particle num ave. triangular flow, v3 VS. eta"
            else if( m2 == 4 )then
                write(10,*) "#! Particle num ave. quadrangular flow, v4 VS. eta"
            end if
            write(10,*) "#! partial phase-space, "// &
                        cut_off(1,1)//" < pT < "//cut_off(2,1)// &
                        "  (nominal cuts of 1-st setting in usu.dat)"
!           Prints names of abscissa and particles.
            write(10,*)  "#!       "//id_abscissa(3)//"               " // &
                  "g                         u+d+s + anti-             " // &
                  "u                         ubar                      " // &
                  "d                         dbar                      " // &
                  "s                         sbar                      " // &
                  "c                         cbar                      " // &
                  "b                         bbar                      " // &
                  "t                         tbar                      " // &
                  "diquarks"
!           Prints data.
            do m1=1,n_bin_hist,1
                write(10,*) xcoor(m1,3), &
                            ( ( dvdeta_p(m1,m2,m3) &
                                / MAX( dNeta_p(m1,m3), 1D-10 ) ), &
                                m3=1,15,1 )
            end do
!-------------------------------------------------------------------------------
!           For full phase-space.
!           Prints names of distributions and cuts.
            if( m2 == 1 )then
                write(10,*) "#! Particle number ave. directed flow, v1 VS. eta"
            else if( m2 == 2 )then
                write(10,*) "#! Particle number ave. elliptic flow, v2 VS. eta"
            else if( m2 == 3 )then
                write(10,*) "#! Particle num ave. triangular flow, v3 VS. eta"
            else if( m2 == 4 )then
                write(10,*) "#! Particle num ave. quadrangular flow, v4 VS. eta"
            end if
            write(10,*) "#! full phase-space"
!           Prints names of abscissa and particles.
            write(10,*)  "#!       "//id_abscissa(3)//"               " // &
                  "g                         u+d+s + anti-             " // &
                  "u                         ubar                      " // &
                  "d                         dbar                      " // &
                  "s                         sbar                      " // &
                  "c                         cbar                      " // &
                  "b                         bbar                      " // &
                  "t                         tbar                      " // &
                  "diquarks"
!           Prints data.
            do m1=1,n_bin_hist,1
                write(10,*) xcoor(m1,3), &
                            ( ( dvdeta_p_f(m1,m2,m3) &
                                / MAX( dNeta_p_f(m1,m3), 1D-10 ) ), &
                                m3=1,15,1 )
            end do
        END DO

!-------------------------------------------------------------------------------
!       Total number of particles for differential flows.
        DO m2=1,3,1
!-------------------------------------------------------------------------------
            write(10,*) "#!-------------------------------------"// &
                        "----------------------------------------"
!           For the partial phase-space.
            if( m2 == 1 )then
!           Prints names of distributions and cuts.
                write(10,*) "#! Num of particles for diff. flows, N VS. y"
                write(10,*) "#! partial phase-space, "// &
                            cut_off(1,1)//" < pT < "//cut_off(2,1)// &
                            "  (nominal cuts of 1-st setting in usu.dat)"
!           Prints names of abscissa and particles.
                write(10,*)  "#!       "//id_abscissa(m2)//"               "// &
                      "g                         u+d+s + anti-             "// &
                      "u                         ubar                      "// &
                      "d                         dbar                      "// &
                      "s                         sbar                      "// &
                      "c                         cbar                      "// &
                      "b                         bbar                      "// &
                      "t                         tbar                      "// &
                      "diquarks"
!           Prints data.
                do m1=1,n_bin_hist,1
                    write(10,*) xcoor(m1,m2), ( dNy_p(m1,m3), m3=1,15,1 )
                end do
            else if( m2 == 2 )then
!           Prints names of distributions and cuts.
                write(10,*) "#! Num of particles for diff. flows, N VS. pT"
                write(10,*) "#! partial phase-space, "// &
                            cut_off(1,2)//" <"//cyeta//"< "//cut_off(2,2)// &
                            "  (nominal cuts of 1-st setting in usu.dat)"
!           Prints names of abscissa and particles.
                write(10,*)  "#!       "//id_abscissa(m2)//"               "// &
                      "g                         u+d+s + anti-             "// &
                      "u                         ubar                      "// &
                      "d                         dbar                      "// &
                      "s                         sbar                      "// &
                      "c                         cbar                      "// &
                      "b                         bbar                      "// &
                      "t                         tbar                      "// &
                      "diquarks"
!           Prints data.
                do m1=1,n_bin_hist,1
                    write(10,*) xcoor(m1,m2), ( dNpT_p(m1,m3), m3=1,15,1 )
                end do
            else if( m2 == 3 )then
!           Prints names of distributions and cuts.
                write(10,*) "#! Num of particles for diff. flows, N VS. eta"
                write(10,*) "#! partial phase-space, "// &
                            cut_off(1,1)//" < pT < "//cut_off(2,1)// &
                            "  (nominal cuts of 1-st setting in usu.dat)"
!           Prints names of abscissa and particles.
                write(10,*)  "#!       "//id_abscissa(m2)//"               "// &
                      "g                         u+d+s + anti-             "// &
                      "u                         ubar                      "// &
                      "d                         dbar                      "// &
                      "s                         sbar                      "// &
                      "c                         cbar                      "// &
                      "b                         bbar                      "// &
                      "t                         tbar                      "// &
                      "diquarks"
!           Prints data.
                do m1=1,n_bin_hist,1
                    write(10,*) xcoor(m1,m2), ( dNeta_p(m1,m3), m3=1,15,1 )
                end do
            end if
!           For the full phase-space.
            if( m2 == 1 )then
!           Prints names of distributions and cuts.
                write(10,*) "#! Num of particles for diff. flows, N VS. y"
                write(10,*) "#! full phase-space"
!           Prints names of abscissa and particles.
                write(10,*)  "#!       "//id_abscissa(m2)//"               "// &
                      "g                         u+d+s + anti-             "// &
                      "u                         ubar                      "// &
                      "d                         dbar                      "// &
                      "s                         sbar                      "// &
                      "c                         cbar                      "// &
                      "b                         bbar                      "// &
                      "t                         tbar                      "// &
                      "diquarks"
!           Prints data.
                do m1=1,n_bin_hist,1
                    write(10,*) xcoor(m1,m2), ( dNy_p_f(m1,m3), m3=1,15,1 )
                end do
            else if( m2 == 2 )then
!           Prints names of distributions and cuts.
                write(10,*) "#! Num of particles for diff. flows, N VS. pT"
                write(10,*) "#! full phase-space"
!           Prints names of abscissa and particles.
                write(10,*)  "#!       "//id_abscissa(m2)//"               "// &
                      "g                         u+d+s + anti-             "// &
                      "u                         ubar                      "// &
                      "d                         dbar                      "// &
                      "s                         sbar                      "// &
                      "c                         cbar                      "// &
                      "b                         bbar                      "// &
                      "t                         tbar                      "// &
                      "diquarks"
!           Prints data.
                do m1=1,n_bin_hist,1
                    write(10,*) xcoor(m1,m2), ( dNpT_p_f(m1,m3), m3=1,15,1 )
                end do
            else if( m2 == 3 )then
!           Prints names of distributions and cuts.
                write(10,*) "#! Num of particles for diff. flows, N VS. eta"
                write(10,*) "#! full phase-space"
!           Prints names of abscissa and particles.
                write(10,*)  "#!       "//id_abscissa(m2)//"               "// &
                      "g                         u+d+s + anti-             "// &
                      "u                         ubar                      "// &
                      "d                         dbar                      "// &
                      "s                         sbar                      "// &
                      "c                         cbar                      "// &
                      "b                         bbar                      "// &
                      "t                         tbar                      "// &
                      "diquarks"
!           Prints data.
                do m1=1,n_bin_hist,1
                    write(10,*) xcoor(m1,m2), ( dNeta_p_f(m1,m3), m3=1,15,1 )
                end do
            end if
        END DO

!-------------------------------------------------------------------------------
!       Total v VS. y.
        DO m2=1,4,1
!-------------------------------------------------------------------------------
            write(10,*) "#!-------------------------------------"// &
                        "----------------------------------------"
!           For the partial phase-space.
!           Prints names of distributions and cuts.
            if( m2 == 1 )then
                write(10,*) "#! Total directed flow, v1 VS. y"
            else if( m2 == 2 )then
                write(10,*) "#! Total elliptic flow, v2 VS. y"
            else if( m2 == 3 )then
                write(10,*) "#! Total triangular flow, v3 VS. y"
            else if( m2 == 4 )then
                write(10,*) "#! Total quadrangular flow, v4 VS. y"
            end if
            write(10,*) "#! partial phase-space, "// &
                        cut_off(1,1)//" < pT < "//cut_off(2,1)// &
                        "  (nominal cuts of 1-st setting in usu.dat)"
!           Prints names of abscissa and particles.
            write(10,*)  "#!       "//id_abscissa(1)//"               " // &
                  "g                         u+d+s + anti-             " // &
                  "u                         ubar                      " // &
                  "d                         dbar                      " // &
                  "s                         sbar                      " // &
                  "c                         cbar                      " // &
                  "b                         bbar                      " // &
                  "t                         tbar                      " // &
                  "diquarks"
!           Prints data.
            do m1=1,n_bin_hist,1
                write(10,*) xcoor(m1,1), ( dvdy_p(m1,m2,m3), m3=1,15,1 )
            end do
!-------------------------------------------------------------------------------
!           For full phase-space.
!           Prints names of distributions and cuts.
            if( m2 == 1 )then
                write(10,*) "#! Total directed flow, v1 VS. y"
            else if( m2 == 2 )then
                write(10,*) "#! Total elliptic flow, v2 VS. y"
            else if( m2 == 3 )then
                write(10,*) "#! Total triangular flow, v3 VS. y"
            else if( m2 == 4 )then
                write(10,*) "#! Total quadrangular flow, v4 VS. y"
            end if
            write(10,*) "#! full phase-space"
!           Prints names of abscissa and particles.
            write(10,*)  "#!       "//id_abscissa(1)//"               " // &
                  "g                         u+d+s + anti-             " // &
                  "u                         ubar                      " // &
                  "d                         dbar                      " // &
                  "s                         sbar                      " // &
                  "c                         cbar                      " // &
                  "b                         bbar                      " // &
                  "t                         tbar                      " // &
                  "diquarks"
!           Prints data.
            do m1=1,n_bin_hist,1
                write(10,*) xcoor(m1,1), ( dvdy_p_f(m1,m2,m3), m3=1,15,1 )
            end do
        END DO
!-------------------------------------------------------------------------------
!       Total v VS. pT.
        DO m2=1,4,1
!-------------------------------------------------------------------------------
            write(10,*) "#!-------------------------------------"// &
                        "----------------------------------------"
!           For the partial phase-space.
!           Prints names of distributions and cuts.
            if( m2 == 1 )then
                write(10,*) "#! Total directed flow, v1 VS. pT"
            else if( m2 == 2 )then
                write(10,*) "#! Total elliptic flow, v2 VS. pT"
            else if( m2 == 3 )then
                write(10,*) "#! Total triangular flow, v3 VS. pT"
            else if( m2 == 4 )then
                write(10,*) "#! Total quadrangular flow, v4 VS. pT"
            end if
            write(10,*) "#! partial phase-space, "// &
                        cut_off(1,2)//" <"//cyeta//"< "//cut_off(2,2)// &
                        "  (nominal cuts of 1-st setting in usu.dat)"
!           Prints names of abscissa and particles.
            write(10,*)  "#!       "//id_abscissa(2)//"               " // &
                  "g                         u+d+s + anti-             " // &
                  "u                         ubar                      " // &
                  "d                         dbar                      " // &
                  "s                         sbar                      " // &
                  "c                         cbar                      " // &
                  "b                         bbar                      " // &
                  "t                         tbar                      " // &
                  "diquarks"
!           Prints data.
            do m1=1,n_bin_hist,1
                write(10,*) xcoor(m1,2), ( dvdpT_p(m1,m2,m3), m3=1,15,1 )
            end do
!-------------------------------------------------------------------------------
!           For full phase-space.
!           Prints names of distributions and cuts.
            if( m2 == 1 )then
                write(10,*) "#! Total directed flow, v1 VS. pT"
            else if( m2 == 2 )then
                write(10,*) "#! Total elliptic flow, v2 VS. pT"
            else if( m2 == 3 )then
                write(10,*) "#! Total triangular flow, v3 VS. pT"
            else if( m2 == 4 )then
                write(10,*) "#! Total quadrangular flow, v4 VS. pT"
            end if
            write(10,*) "#! full phase-space"
!           Prints names of abscissa and particles.
            write(10,*)  "#!       "//id_abscissa(2)//"               " // &
                  "g                         u+d+s + anti-             " // &
                  "u                         ubar                      " // &
                  "d                         dbar                      " // &
                  "s                         sbar                      " // &
                  "c                         cbar                      " // &
                  "b                         bbar                      " // &
                  "t                         tbar                      " // &
                  "diquarks"
!           Prints data.
            do m1=1,n_bin_hist,1
                write(10,*) xcoor(m1,2), ( dvdpT_p_f(m1,m2,m3), m3=1,15,1 )
            end do
        END DO
!-------------------------------------------------------------------------------
!       Total v VS. eta.
        DO m2=1,4,1
!-------------------------------------------------------------------------------
            write(10,*) "#!-------------------------------------"// &
                        "----------------------------------------"
!           For the partial phase-space.
!           Prints names of distributions and cuts.
            if( m2 == 1 )then
                write(10,*) "#! Total directed flow, v1 VS. eta"
            else if( m2 == 2 )then
                write(10,*) "#! Total elliptic flow, v2 VS. eta"
            else if( m2 == 3 )then
                write(10,*) "#! Total triangular flow, v3 VS. eta"
            else if( m2 == 4 )then
                write(10,*) "#! Total quadrangular flow, v4 VS. eta"
            end if
            write(10,*) "#! partial phase-space, "// &
                        cut_off(1,1)//" < pT < "//cut_off(2,1)// &
                        "  (nominal cuts of 1-st setting in usu.dat)"
!           Prints names of abscissa and particles.
            write(10,*)  "#!       "//id_abscissa(3)//"               " // &
                  "g                         u+d+s + anti-             " // &
                  "u                         ubar                      " // &
                  "d                         dbar                      " // &
                  "s                         sbar                      " // &
                  "c                         cbar                      " // &
                  "b                         bbar                      " // &
                  "t                         tbar                      " // &
                  "diquarks"
!           Prints data.
            do m1=1,n_bin_hist,1
                write(10,*) xcoor(m1,3), ( dvdeta_p(m1,m2,m3), m3=1,15,1 )
            end do
!-------------------------------------------------------------------------------
!           For full phase-space.
!           Prints names of distributions and cuts.
            if( m2 == 1 )then
                write(10,*) "#! Total directed flow, v1 VS. eta"
            else if( m2 == 2 )then
                write(10,*) "#! Total elliptic flow, v2 VS. eta"
            else if( m2 == 3 )then
                write(10,*) "#! Total triangular flow, v3 VS. eta"
            else if( m2 == 4 )then
                write(10,*) "#! Total quadrangular flow, v4 VS. eta"
            end if
            write(10,*) "#! full phase-space"
!           Prints names of abscissa and particles.
            write(10,*)  "#!       "//id_abscissa(3)//"               " // &
                  "g                         u+d+s + anti-             " // &
                  "u                         ubar                      " // &
                  "d                         dbar                      " // &
                  "s                         sbar                      " // &
                  "c                         cbar                      " // &
                  "b                         bbar                      " // &
                  "t                         tbar                      " // &
                  "diquarks"
!           Prints data.
            do m1=1,n_bin_hist,1
                write(10,*) xcoor(m1,3), ( dvdeta_p_f(m1,m2,m3), m3=1,15,1 )
            end do
        END DO


        return
        end



!ccccccccccccccccccccccccccccccccccccc end ccccccccccccccccccccccccccccccccccccc